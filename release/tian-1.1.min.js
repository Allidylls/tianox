//=======================================================================================================
// Tian Web Desktop Framework
//
// Free use of this software is granted under the terms of the MIT License.
// For details see: https://raw.github.com/Allidylls/tianox/master/LICENSE.
//
// Contains portions of Require.js: https://raw.github.com/jrburke/requirejs/master/LICENSE
// Contains portions of OpenLayers.js: http://svn.openlayers.org/trunk/openlayers/license.txt
// Contains portions of jQuery.js: http://jquery.org/license
// Contains portions of binary.js: http://ats.oka.nu/titaniumcore/js/tools/binary.readme.txt
// Contains portions of Node.js: https://raw.github.com/joyent/node/v0.6.18/LICENSE
// Contains portions of md5.js: https://github.com/blueimp/Javascript-MD5
// Contains portions of jStorage.js: http://www.jstorage.info/static/license.txt
// Contains portions of jwim.js: https://github.com/poplix/jwim
//-------------------------------------------------------------------------------------------------------
var Tian={};Tian.VERSION="1.1",Tian.BROWSER=function(){var t="",e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("opera")?t="opera":-1!=e.indexOf("msie")?t="msie":-1!=e.indexOf("safari")?t="safari":-1!=e.indexOf("mozilla")&&(t=-1!=e.indexOf("firefox")?"firefox":"mozilla"),t}(),Tian.ISGECKO=function(){var t=navigator.userAgent.toLowerCase();return-1==t.indexOf("webkit")&&-1!=t.indexOf("gecko")}(),Tian.Temp={},Tian.createUniqueID=function(){var t={};return function(e){return e=e||"txID_",e+="","number"!=typeof t[e]&&(t[e]=0),t[e]+=1,e+t[e]}}(),Tian.getScriptLocation=function(t,e){if(e=e||document,"function"!=typeof e.getElementsByTagName)return"";var n,i,s,o,r="";n="string"==typeof t?new RegExp("(^|(.*?\\/))("+t+")(\\?|$)"):new RegExp("(^|(.*?\\/))(tian-"+Tian.VERSION+".min.js)(\\?|$)"),i=e.getElementsByTagName("script");for(var a=0,h=i.length;h>a;a++)if(s=i[a].getAttribute("src")){var o=s.match(n);if(o){r=o[1];break}}return r},Tian.getElement=function(){for(var t=[],e=0,n=arguments.length;n>e;e++){var i=arguments[e];if("string"==typeof i&&(i=document.getElementById(i)),1==arguments.length)return i;t.push(i)}return t},Tian.getStyle=function(t,e){t=Tian.getElement(t);var n=null;if(t&&t.style){if(n=t.style[Tian.String.camelize(e)],!n)if(document.defaultView&&document.defaultView.getComputedStyle){var i=document.defaultView.getComputedStyle(t,null);n=i?i.getPropertyValue(e):null}else t.currentStyle&&(n=t.currentStyle[Tian.String.camelize(e)]);var s=["left","top","right","bottom"];window.opera&&-1!=Tian.Array.indexOf(s,e)&&"static"==Tian.getStyle(t,"position")&&(n="auto")}return"auto"==n?null:n},Tian.getViewportElement=function(){var t=arguments.callee.viewportElement;return void 0==t&&(t="msie"==Tian.BROWSER&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=t),t},Tian.pagePosition=function(t){var e=[0,0],n=Tian.getViewportElement();if(!t||t==window||t==n)return e;var i,s=Tian.ISGECKO&&document.getBoxObjectFor&&"absolute"==Tian.getStyle(t,"position")&&(""==t.style.top||""==t.style.left),o=null;if(t.getBoundingClientRect){i=t.getBoundingClientRect();var r=window.pageYOffset||n.scrollTop,a=window.pageXOffset||n.scrollLeft;e[0]=i.left+a,e[1]=i.top+r}else if(document.getBoxObjectFor&&!s){i=document.getBoxObjectFor(t);var h=document.getBoxObjectFor(n);e[0]=i.screenX-h.screenX,e[1]=i.screenY-h.screenY}else{if(e[0]=t.offsetLeft,e[1]=t.offsetTop,o=t.offsetParent,o!=t)for(;o;)e[0]+=o.offsetLeft,e[1]+=o.offsetTop,o=o.offsetParent;var l=Tian.BROWSER;for(("opera"==l||"safari"==l&&"absolute"==Tian.getStyle(t,"position"))&&(e[1]-=document.body.offsetTop),o=t.offsetParent;o&&o!=document.body;)e[0]-=o.scrollLeft,("opera"!=l||"TR"!=o.tagName)&&(e[1]-=o.scrollTop),o=o.offsetParent}return e},Tian.extend=function(t,e){if(t=t||{},e){for(var n in e){var i=e[n];void 0!==i&&(t[n]=i)}var s="function"==typeof window.Event&&e instanceof window.Event;!s&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&(t.toString=e.toString)}return t},Tian.applyDefaults=function(t,e){t=t||{};var n="function"==typeof window.Event&&e instanceof window.Event;for(var i in e)(void 0===t[i]||!n&&e.hasOwnProperty&&e.hasOwnProperty(i)&&!t.hasOwnProperty(i))&&(t[i]=e[i]);return!n&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!t.hasOwnProperty("toString")&&(t.toString=e.toString),t},function(t){"use strict";function e(t,e){var n=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(n>>16);return i<<16|65535&n}function n(t,e){return t<<e|t>>>32-e}function i(t,i,s,o,r,a){return e(n(e(e(i,t),e(o,a)),r),s)}function s(t,e,n,s,o,r,a){return i(e&n|~e&s,t,e,o,r,a)}function o(t,e,n,s,o,r,a){return i(e&s|n&~s,t,e,o,r,a)}function r(t,e,n,s,o,r,a){return i(e^n^s,t,e,o,r,a)}function a(t,e,n,s,o,r,a){return i(n^(e|~s),t,e,o,r,a)}function h(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;var i,h,l,u,c,f=1732584193,d=-271733879,p=-1732584194,m=271733878;for(i=0;i<t.length;i+=16)h=f,l=d,u=p,c=m,f=s(f,d,p,m,t[i],7,-680876936),m=s(m,f,d,p,t[i+1],12,-389564586),p=s(p,m,f,d,t[i+2],17,606105819),d=s(d,p,m,f,t[i+3],22,-1044525330),f=s(f,d,p,m,t[i+4],7,-176418897),m=s(m,f,d,p,t[i+5],12,1200080426),p=s(p,m,f,d,t[i+6],17,-1473231341),d=s(d,p,m,f,t[i+7],22,-45705983),f=s(f,d,p,m,t[i+8],7,1770035416),m=s(m,f,d,p,t[i+9],12,-1958414417),p=s(p,m,f,d,t[i+10],17,-42063),d=s(d,p,m,f,t[i+11],22,-1990404162),f=s(f,d,p,m,t[i+12],7,1804603682),m=s(m,f,d,p,t[i+13],12,-40341101),p=s(p,m,f,d,t[i+14],17,-1502002290),d=s(d,p,m,f,t[i+15],22,1236535329),f=o(f,d,p,m,t[i+1],5,-165796510),m=o(m,f,d,p,t[i+6],9,-1069501632),p=o(p,m,f,d,t[i+11],14,643717713),d=o(d,p,m,f,t[i],20,-373897302),f=o(f,d,p,m,t[i+5],5,-701558691),m=o(m,f,d,p,t[i+10],9,38016083),p=o(p,m,f,d,t[i+15],14,-660478335),d=o(d,p,m,f,t[i+4],20,-405537848),f=o(f,d,p,m,t[i+9],5,568446438),m=o(m,f,d,p,t[i+14],9,-1019803690),p=o(p,m,f,d,t[i+3],14,-187363961),d=o(d,p,m,f,t[i+8],20,1163531501),f=o(f,d,p,m,t[i+13],5,-1444681467),m=o(m,f,d,p,t[i+2],9,-51403784),p=o(p,m,f,d,t[i+7],14,1735328473),d=o(d,p,m,f,t[i+12],20,-1926607734),f=r(f,d,p,m,t[i+5],4,-378558),m=r(m,f,d,p,t[i+8],11,-2022574463),p=r(p,m,f,d,t[i+11],16,1839030562),d=r(d,p,m,f,t[i+14],23,-35309556),f=r(f,d,p,m,t[i+1],4,-1530992060),m=r(m,f,d,p,t[i+4],11,1272893353),p=r(p,m,f,d,t[i+7],16,-155497632),d=r(d,p,m,f,t[i+10],23,-1094730640),f=r(f,d,p,m,t[i+13],4,681279174),m=r(m,f,d,p,t[i],11,-358537222),p=r(p,m,f,d,t[i+3],16,-722521979),d=r(d,p,m,f,t[i+6],23,76029189),f=r(f,d,p,m,t[i+9],4,-640364487),m=r(m,f,d,p,t[i+12],11,-421815835),p=r(p,m,f,d,t[i+15],16,530742520),d=r(d,p,m,f,t[i+2],23,-995338651),f=a(f,d,p,m,t[i],6,-198630844),m=a(m,f,d,p,t[i+7],10,1126891415),p=a(p,m,f,d,t[i+14],15,-1416354905),d=a(d,p,m,f,t[i+5],21,-57434055),f=a(f,d,p,m,t[i+12],6,1700485571),m=a(m,f,d,p,t[i+3],10,-1894986606),p=a(p,m,f,d,t[i+10],15,-1051523),d=a(d,p,m,f,t[i+1],21,-2054922799),f=a(f,d,p,m,t[i+8],6,1873313359),m=a(m,f,d,p,t[i+15],10,-30611744),p=a(p,m,f,d,t[i+6],15,-1560198380),d=a(d,p,m,f,t[i+13],21,1309151649),f=a(f,d,p,m,t[i+4],6,-145523070),m=a(m,f,d,p,t[i+11],10,-1120210379),p=a(p,m,f,d,t[i+2],15,718787259),d=a(d,p,m,f,t[i+9],21,-343485551),f=e(f,h),d=e(d,l),p=e(p,u),m=e(m,c);return[f,d,p,m]}function l(t){var e,n="";for(e=0;e<32*t.length;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}function u(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;e<n.length;e+=1)n[e]=0;for(e=0;e<8*t.length;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}function c(t){return l(h(u(t),8*t.length))}function f(t,e){var n,i,s=u(t),o=[],r=[];for(o[15]=r[15]=void 0,s.length>16&&(s=h(s,8*t.length)),n=0;16>n;n+=1)o[n]=909522486^s[n],r[n]=1549556828^s[n];return i=h(o.concat(u(e)),512+8*e.length),l(h(r.concat(i),640))}function d(t){var e,n,i="0123456789abcdef",s="";for(n=0;n<t.length;n+=1)e=t.charCodeAt(n),s+=i.charAt(e>>>4&15)+i.charAt(15&e);return s}function p(t){return unescape(encodeURIComponent(t))}function m(t){return c(p(t))}function g(t){return d(m(t))}function v(t,e){return f(p(t),p(e))}function w(t,e){return d(v(t,e))}function T(t,e,n){return e?n?v(e,t):w(e,t):n?m(t):g(t)}t.md5=T}(Tian),Tian.Array={isArray:function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},indexOf:function(t,e){if("function"==typeof t.indexOf)return t.indexOf(e);for(var n=0,i=t.length;i>n;n++)if(t[n]==e)return n;return-1},removeItem:function(t,e){for(var n=t.length-1;n>=0;n--)t[n]==e&&t.splice(n,1);return t},filter:function(t,e,n){var i=[];if(Array.prototype.filter)i=t.filter(e,n);else{var s=t.length;if("function"!=typeof e)throw new TypeError;for(var o=0;s>o;o++)if(o in t){var r=t[o];e.call(n,r,o,t)&&i.push(r)}}return i}},Tian.String={startsWith:function(t,e){return 0==t.indexOf(e)},contains:function(t,e){return-1!=t.indexOf(e)},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(t){for(var e=t.split("-"),n=e[0],i=1,s=e.length;s>i;i++){var o=e[i];n+=o.charAt(0).toUpperCase()+o.substring(1)}return n},format:function(t,e,n){e=e||window;var i=/\$\{([\w.]+?)\}/g,s=function(t,i){for(var s,o=i.split(/\.+/),r=0;r<o.length;r++)0==r&&(s=e),s=s[o[r]];return"function"==typeof s&&(s=n?s.apply(null,n):s()),"undefined"==typeof s?"undefined":s};return t.replace(i,s)},isNumeric:function(t){var e=/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/;return e.test(t)},numericIf:function(t){return Tian.String.isNumeric(t)?parseFloat(t):t},isEmail:function(t){var e=/^([\w\d_\.-]+)@([\w\d_-]+\.)+\w{2,5}$/;return e.test(t)},isURL:function(t){var e=/^(https?:\/\/)?([\w\d_-]+\.)+\w{2,5}(\/[\w\d\.\?-_%=&]+)*$/;return e.test(t)},sprintf:function(){var t=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,e=arguments,n=0,i=e[n++],s=function(t,e,n,i){n||(n=" ");var s=t.length>=e?"":Array(1+e-t.length>>>0).join(n);return i?t+s:s+t},o=function(t,e,n,i,o,r){var a=i-t.length;return a>0&&(t=n||!o?s(t,i,r,n):t.slice(0,e.length)+s("",a,"0",!0)+t.slice(e.length)),t},r=function(t,e,n,i,r,a,h){var l=t>>>0;return n=n&&l&&{2:"0b",8:"0",16:"0x"}[e]||"",t=n+s(l.toString(e),a||0,"0",!1),o(t,n,i,r,h)},a=function(t,e,n,i,s,r){return null!=i&&(t=t.slice(0,i)),o(t,"",e,n,s,r)},h=function(t,i,h,l,u,c,f){var d,p,m,g,v;if("%%"==t)return"%";for(var w=!1,T="",y=!1,b=!1,E=" ",S=h.length,x=0;h&&S>x;x++)switch(h.charAt(x)){case" ":T=" ";break;case"+":T="+";break;case"-":w=!0;break;case"'":E=h.charAt(x+1);break;case"0":y=!0;break;case"#":b=!0}if(l=l?"*"==l?+e[n++]:"*"==l.charAt(0)?+e[l.slice(1,-1)]:+l:0,0>l&&(l=-l,w=!0),!isFinite(l))throw new Error("sprintf: (minimum-)width must be finite");switch(c=c?"*"==c?+e[n++]:"*"==c.charAt(0)?+e[c.slice(1,-1)]:+c:"fFeE".indexOf(f)>-1?6:"d"==f?0:void 0,v=i?e[i.slice(0,-1)]:e[n++],f){case"s":return a(String(v),w,l,c,y,E);case"c":return a(String.fromCharCode(+v),w,l,c,y);case"b":return r(v,2,b,w,l,c,y);case"o":return r(v,8,b,w,l,c,y);case"x":return r(v,16,b,w,l,c,y);case"X":return r(v,16,b,w,l,c,y).toUpperCase();case"u":return r(v,10,b,w,l,c,y);case"i":case"d":return d=+v||0,d=Math.round(d-d%1),p=0>d?"-":T,v=p+s(String(Math.abs(d)),c,"0",!1),o(v,p,w,l,y);case"e":case"E":case"f":case"F":case"g":case"G":return d=+v,p=0>d?"-":T,m=["toExponential","toFixed","toPrecision"]["efg".indexOf(f.toLowerCase())],g=["toString","toUpperCase"]["eEfFgG".indexOf(f)%2],v=p+Math.abs(d)[m](c),o(v,p,w,l,y)[g]();default:return t}};return i.replace(t,h)},sscanf:function(t,e){var n,i=[],s=/\S/,o=function(t){var n=e.slice(t).match(/%[cdeEufgosxX]/g);if(n)for(var s=n.length;s--;)i.push(null);return i},r=function(e,s,o){if(u){var r=t.slice(e),a=l?r.substr(0,l):r,h=s.exec(a),c=i[void 0!==n?n:i.length]=h?o?o.apply(null,h):h[0]:null;if(null===c)throw"No match in string";return e+h[0].length}return e};if(arguments.length<2)throw"Not enough arguments passed to sscanf";for(var a=0,h=0;a<e.length;a++){var l=0,u=!0;if("%"===e.charAt(a)){if("%"===e.charAt(a+1)){if("%"===t.charAt(h)){++a,++h;continue}return o(a+2)}var c=new RegExp("^(?:(\\d+)\\$)?(\\*)?(\\d*)([hlL]?)","g"),f=c.exec(e.slice(a+1)),d=n;if(d&&void 0===f[1])throw"All groups in sscanf() must be expressed as numeric if any have already been used";n=f[1]?parseInt(f[1],10)-1:void 0,u=!f[2],l=parseInt(f[3],10);var p=f[4];if(a+=c.lastIndex,p)switch(p){case"h":case"l":case"L":break;default:throw"Unexpected size specifier in sscanf()!"}try{switch(e.charAt(a+1)){case"F":break;case"g":break;case"G":break;case"b":break;case"i":h=r(h,/([+-])?(?:(?:0x([\da-fA-F]+))|(?:0([0-7]+))|(\d+))/,function(t,e,n,i){return n?parseInt(t,16):i?parseInt(t,8):parseInt(t,10)});break;case"n":i[void 0!==n?n:i.length-1]=h;break;case"c":h=r(h,new RegExp(".{1,"+(l||1)+"}"));break;case"D":case"d":h=r(h,/([+-])?(?:0*)(\d+)/,function(t,e,n){var i=parseInt((e||"")+n,10);return i});break;case"f":case"E":case"e":h=r(h,/([+-])?(?:0*)(\d*\.?\d*(?:[eE]?\d+)?)/,function(t,e,n){return"."===n?null:parseFloat((e||"")+n)});break;case"u":h=r(h,/([+-])?(?:0*)(\d+)/,function(t,e,n){var i=parseInt(n,10);return"-"===e?4294967296-i:4294967295>i?i:4294967295});break;case"o":h=r(h,/([+-])?(?:0([0-7]+))/,function(t){return parseInt(t,8)});break;case"s":h=r(h,/\S+/);break;case"X":case"x":h=r(h,/([+-])?(?:(?:0x)?([\da-fA-F]+))/,function(t){return parseInt(t,16)});break;case"":throw"Missing character after percent mark in sscanf() format argument";default:throw"Unrecognized character after percent mark in sscanf() format argument"}}catch(m){if("No match in string"===m)return o(a+2)}++a}else if(e.charAt(a)!==t.charAt(h)){if(s.lastIndex=0,s.test(t.charAt(h))||""===t.charAt(h))return o(a+1);t=t.slice(0,h)+t.slice(h+1),a--}else h++}return i}},Tian.inherit=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n;var i,s,o;for(i=2,s=arguments.length;s>i;i++)o=arguments[i],"function"==typeof o&&(o=o.prototype),Tian.extend(t.prototype,o)},Tian.Class=function(){var t=arguments.length,e=arguments[0],n=arguments[t-1],i="function"==typeof n.initialize?n.initialize:function(){e.prototype.initialize.apply(this,arguments)};if(t>1){var s=[i,e].concat(Array.prototype.slice.call(arguments).slice(1,t-1),n);Tian.inherit.apply(null,s)}else i.prototype=n;return i},Tian.Function={bind:function(t,e){var n=Array.prototype.slice.apply(arguments,[2]);return function(){var i=n.concat(Array.prototype.slice.apply(arguments,[0]));return t.apply(e,i)}},bindAsEventListener:function(t,e){return function(n){return t.call(e,n||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},Tian.Window=Tian.Class({id:"",wm:null,w:0,h:0,x:0,y:0,userW:0,userH:0,userX:0,userY:0,movable:!1,alwaysOnTop:!1,resizing:!1,moving:!1,animating:!1,titleText:"",title:null,titleSpan:null,iconImageURL:"",state:"window",prvState:"",win:null,content:null,taskbarIcon:null,taskbarIconSpan:null,taskbarIconImage:null,components:null,currentUrl:"",closeConfirm:"",onunload:null,onselect:null,onresize:null,onmove:null,oniconize:null,ondeselect:null,onclose:null,initialize:function(t,e){this.id=t.id||Tian.createUniqueID(),this.wm=e,this.w="number"==typeof t.width?t.width:e.opts.defaultWidth,this.h="number"==typeof t.height?t.height:e.opts.defaultHeight,this.x="number"==typeof t.x?t.x:e.opts.defaultX,this.y="number"==typeof t.y?t.y:e.opts.defaultY,t.centered&&(this.x=(e.getContainerWidth()-this.w)/2,this.y=(e.getContainerHeight()-this.h)/2,this.x<0&&(this.x=0),this.y<0&&(this.y=0)),this.userW=this.w,this.userH=this.h,this.movable="undefined"==typeof t.movable?e.opts.movable:t.movable,this.alwaysOnTop=t.alwaysOnTop||!1,this.titleText=t.title||"",this.iconImageURL=t.iconImageURL||"",this.components={titlebar:null,window:null,content:null,close:null,iconizer:null,maximizer:null,loading:null,zoomer:null,icon:null}},destroy:function(){},attachEvents:function(){var t=this.titleSpan;t&&(Tian.Event.observe(t,"mousedown",Tian.Function.bind(this.onTitleMouseDown,this)),Tian.Event.observe(t,"touchstart",Tian.Function.bind(this.onTitleMouseDown,this)),Tian.Event.observe(t,"mousemove",Tian.Function.bind(this.onTitleMouseMove,this)),Tian.Event.observe(t,"touchmove",Tian.Function.bind(this.onTitleMouseMove,this)),Tian.Event.observe(t,"mouseup",Tian.Function.bind(this.onTitleMouseUp,this)),Tian.Event.observe(t,"mouseout",Tian.Function.bind(this.onTitleMouseUp,this)),Tian.Event.observe(t,"touchend",Tian.Function.bind(this.onTitleMouseUp,this)));var e=this.components.close;e&&Tian.Event.observe(e,"click",Tian.Function.bind(this.onCloseClick,this));var n=this.components.maximizer;n&&Tian.Event.observe(n,"click",Tian.Function.bind(this.onMaxClick,this));var i=this.components.iconizer;i&&Tian.Event.observe(i,"click",Tian.Function.bind(this.onMinClick,this));var s=this.components.zoomer;s&&(Tian.Event.observe(s,"mousedown",Tian.Function.bind(this.onZoomMouseDown,this)),Tian.Event.observe(s,"touchstart",Tian.Function.bind(this.onZoomMouseDown,this)),Tian.Event.observe(s,"mousemove",Tian.Function.bind(this.onZoomMouseMove,this)),Tian.Event.observe(s,"touchmove",Tian.Function.bind(this.onZoomMouseMove,this)),Tian.Event.observe(s,"mouseup",Tian.Function.bind(this.onZoomMouseUp,this)),Tian.Event.observe(s,"mouseout",Tian.Function.bind(this.onZoomMouseUp,this)),Tian.Event.observe(s,"touchend",Tian.Function.bind(this.onZoomMouseUp,this))),this.win&&Tian.Event.observe(this.win,"click",Tian.Function.bind(this.onWinClick,this))},detachEvents:function(){var t=this.titleSpan;t&&Tian.Event.stopObservingElement(t);var e=this.components.close;e&&Tian.Event.stopObservingElement(e);var n=this.components.maximizer;n&&Tian.Event.stopObservingElement(n);var i=this.components.iconizer;i&&Tian.Event.stopObservingElement(i);var s=this.components.zoomer;s&&Tian.Event.stopObservingElement(s),this.win&&Tian.Event.stopObservingElement(this.win)},onTitleMouseDown:function(t){if(!this.animating&&"maximized"!==this.state&&(Tian.Event.stop(t),this.select(),this.movable)){this.moving=!0,t||(t=window.event);var e=this.wm.getEventXY(t,this.titleSpan);this.wm.mouse.click.x=e.x-this.x,this.wm.mouse.click.y=e.y-this.y}},onTitleMouseMove:function(t){if(!this.animating&&"maximized"!==this.state&&this.moving){Tian.Event.stop(t),t||(t=window.event),this.state="window";var e=this.wm.getEventXY(t,this.titleSpan);this.wm.mouse.cur.x=e.x,this.wm.mouse.cur.y=e.y;var n=this.wm.mouse.cur.y-this.wm.mouse.click.y,i=this.wm.mouse.cur.x-this.wm.mouse.click.x;if(this.wm.opts.containerBoundaries>0){var s=-1*(this.getWidth()-this.wm.opts.containerBoundaries),o=this.getContainerWidth()-this.wm.opts.containerBoundaries,r=this.getContainerHeight()-this.wm.opts.containerBoundaries;s>i&&(i=s),i>o&&(i=o),n>r&&(n=r)}this.wm.opts.containerBoundaries>-1&&0>n&&(n=0),this.win.style.left=i+"px",this.win.style.top=n+"px","function"==typeof this.onmove&&this.onmove(i,n)}},onTitleMouseUp:function(t){!this.animating&&"maximized"!==this.state&&this.moving&&(Tian.Event.stop(t),this.moving=!1,"window"===this.state&&(this.w=parseInt(this.win.style.width,10),this.h=parseInt(this.win.style.height,10),this.x=parseInt(this.win.style.left,10),this.y=parseInt(this.win.style.top,10),this.userW=this.w,this.userH=this.h,this.userX=this.x,this.userY=this.y))},onZoomMouseDown:function(t){if(!this.animating&&"maximized"!==this.state){Tian.Event.stop(t),this.select(),this.resizing=!0,t||(t=window.event);var e=this.wm.getEventXY(t,this.components.zoomer);this.wm.mouse.click.rx=e.x,this.wm.mouse.click.ry=e.y,this.wm.mouse.click.x=e.x-this.x,this.wm.mouse.click.y=e.y-this.y}},onZoomMouseMove:function(t){if(!this.animating&&"maximized"!==this.state&&this.resizing){Tian.Event.stop(t),this.state="window",t||(t=window.event);var e=this.wm.getEventXY(t,this.components.zoomer);this.wm.mouse.cur.x=e.x,this.wm.mouse.cur.y=e.y;var n=this.wm.mouse.cur.y-this.wm.mouse.click.y;if(this.wm.opts.containerBoundaries>0){var i=this.getContainerHeight()-this.wm.opts.containerBoundaries;n>i&&(n=i)}this.wm.opts.containerBoundaries>-1&&0>n&&(n=0),this.win.style.top=n+"px";var s=this.h+(this.wm.mouse.click.ry-this.wm.mouse.cur.y),o=this.w+(this.wm.mouse.cur.x-this.wm.mouse.click.rx);90>o&&(o=90),50>s&&(s=50),this._setSize(o,s,!0,"resize")}},onZoomMouseUp:function(t){!this.animating&&"maximized"!==this.state&&this.resizing&&(Tian.Event.stop(t),this.resizing=!1,"window"===this.state&&(this.w=parseInt(this.win.style.width,10),this.h=parseInt(this.win.style.height,10),this.x=parseInt(this.win.style.left,10),this.y=parseInt(this.win.style.top,10),this.userW=this.w,this.userH=this.h,this.userX=this.x,this.userY=this.y))},onCloseClick:function(t){Tian.Event.stop(t),this.select(),this.closeConfirm?window.confirm(this.closeConfirm)&&this.close():this.close()},onMaxClick:function(t){Tian.Event.stop(t),this.select(),this._maximize()},onMinClick:function(t){Tian.Event.stop(t),this.select(),this._iconify()},onWinClick:function(){this.select()},getElement:function(t,e){e||(e=this.content);for(var n=0;n<e.childNodes.length;n++){if(e.childNodes[n].getAttribute&&e.childNodes[n].getAttribute("data-wid")==t)return e.childNodes[n];var i=this.getElement(t,e.childNodes[n]);if(i)return i}return null},setState:function(t){switch(t){case"maximized":if("maximized"==this.state)return;return this._maximize(),void 0;case"window":return"maximized"==this.state?(this._maximize(),void 0):(this.state="window",this.select(),void 0);case"icon":return this._iconify(),void 0;case"hidden":return this.hide(),void 0}},setSize:function(t,e){this.state="window",this._setSize(t,e,!1,"resize"),this.userW=t,this.userH=e},autoSize:function(){this.win.style.height="0px",this.win.style.width="0px",this.content.style.height="0px",this.content.style.width="0px";var t=this.content.scrollWidth+30,e=this.content.scrollHeight+70;this.setSize(t,e),this.state="window"},setPosition:function(t,e){this._setPosition(t,e),this.userX=t,this.userY=e,"function"==typeof this.onmove&&this.onmove(t,e)},moveToCenter:function(){var t,e;t=(this.getContainerWidth()-this.w)/2,e=(this.getContainerHeight()-this.h)/2,0>e&&(e=0),this.setPosition(t,e)},close:function(){this.wm._destroyWindow(this)},select:function(){this.wm._selectWindow(this)},hide:function(){this.prvState=this.state,this.state="hidden",this.win.style.visibility="hidden",this.win.style.display="none"},show:function(){this.state=this.prvState,this.win.style.visibility="visible",this.win.style.display=""},attachTo:function(t){t=t||this.wm.opts.container,t.appendChild(this.win)},setContent:function(t,e){e||(e=this.content),e.innerHTML=t.replace(/<script.*?>[\s\S]*?<\/.*?script>/gi,"")},loadUrlX:function(t,e){var n=this;n.showLoading();var i=n.content;i.innerHTML="";var s=document.createElement("iframe");s.className=n.wm.opts.classFrame,s.setAttribute("data-wid","theFrame"),s.src=t,i.appendChild(s);var o=function(){n.currentUrl=t,n.showLoading(!1),"function"==typeof e&&e.apply(n,[n]),Tian.Event.stopObservingElement(s),s=null,n=null};Tian.Event.observe(s,"load",o)},showLoading:function(t){var e="undefined"==typeof t||t,n=this.loading.style;n.display=e?"":"none",n.visibility=e?"visible":"hidden"},setTitle:function(t){t&&(this.titleText=t,this.titleSpan&&(this.titleSpan.innerHTML=t),this.taskbarIcon&&this.taskbarIcon.setAttribute("title",t),this.taskbarIconSpan&&(this.taskbarIconSpan.innerHTML=t))},setIconImage:function(t){t&&t!==this.iconImageURL&&(this.iconImageURL=t,this.taskbarIconImage&&(this.taskbarIconImage.src=t))},setCloseConfirm:function(t){this.closeConfirm=t},setMovable:function(t){this.movable=t},setAlwaysOnTop:function(t){t&&this.select(),this.alwaysOnTop=t},isMovable:function(){return this.movable},isAlwaysOnTop:function(){return this.alwaysOnTop},isSelected:function(){return this===this.getManager().getSelectedWindow()},getManager:function(){return this.wm},getComponent:function(t){return this.components[t]},getWidth:function(){return this.w},getHeight:function(){return this.h},getX:function(){return this.x},getY:function(){return this.y},getContentWidth:function(){return parseInt(this.content.style.width,10)},getContentHeight:function(){return parseInt(this.content.style.height,10)},getId:function(){return this.id},getTitle:function(){return this.titleText},getCurrentUrl:function(){return this.currentUrl},getState:function(){return this.state},getContainer:function(){return this.win.parentNode},getContainerWidth:function(){var t=this.getContainer();return t===document.body?this.wm.getBodySize().width:t.clientWidth},getContainerHeight:function(){var t=this.getContainer();return t===document.body?this.wm.getBodySize().height:t.clientHeight},_setPosition:function(t,e){this.win.style.left=t+"px",this.win.style.top=e+"px",this.x=t,this.y=e},_setSize:function(t,e,n,i){this.win.style.height=e+"px",this.win.style.width=t+"px";var s=t-(this.content.offsetWidth-parseInt(this.content.style.width,10)),o=e-(this.content.offsetHeight-parseInt(this.content.style.height,10))-this.content.offsetTop;this.content.style.height=o+"px",this.content.style.width=s+"px",n||(this.w=t,this.h=e),i&&"function"==typeof this.onresize&&this.onresize(t,e,i)},_maximize:function(){if(!this.animating){var t=20,e=10,n=this,i=this.win.offsetWidth-parseInt(this.win.style.width),s=this.win.offsetHeight-parseInt(this.win.style.height),o=this.getContainerWidth()-i,r=this.getContainerHeight()-s,a=Math.abs(0-this.userX)/e,h=Math.abs(0-this.userY)/e,l=Math.abs(o-this.userW)/e,u=Math.abs(r-this.userH)/e,c=this.state,f=function(){e-=1;var i="maximized"===c?10-e:e;n._setPosition(0+i*a,0+i*h),n._setSize(o-i*l,r-i*u,!1),e>0?setTimeout(f,t):("maximized"===c?(n._setPosition(n.userX,n.userY),n._setSize(n.userW,n.userH,!1,"restore"),n.state="window"):(n._setPosition(0,0),n._setSize(o,r,!1,"maximize"),n.state="maximized"),n.animating=!1,n=null,f=null)};this.animating=!0,setTimeout(f,t)}},_iconify:function(){if(!this.animating){var t=this.taskbarIcon.offsetLeft+this.taskbarIcon.offsetParent.offsetLeft,e=this.taskbarIcon.offsetTop+this.taskbarIcon.offsetParent.offsetTop,n=20,i=10,s=(t-this.userX)/i,o=(e-this.userY)/i,r=this.userW/i,a=this.userH/i,h=this.state,l=this,u=function(){i-=1;var c=i;if("icon"===h&&(c=10-i),l._setPosition(t-c*s,e-c*o),l._setSize(c*r,c*a,!1),i>0)setTimeout(u,n);else{if(l.animating=!1,"icon"===h)l.state="window";else{l.hide(),l.state="icon";var f=l.wm._getFirstVisibleWindow();f&&f.select(),"function"==typeof l.oniconize&&l.oniconize()}l=null,u=null}};if(this.isSelected()){if(!this.wm.taskbar||"icon"===this.state)return;this.taskbarIcon||this._createTaskbarIcon(),this.taskbarIcon.className=this.wm.opts.classIcon,this.wm.selectedWindow===this&&(this.wm.selectedWindow=null),this.animating=!0,setTimeout(u,n)}else"icon"==this.state?(this.select(),this.animating=!0,setTimeout(u,n)):this.select()}},_createTaskbarIcon:function(){if(this.wm.taskbar){var t=document.createElement("div");t.className=this.wm.opts.classIcon,t.setAttribute("title",this.titleText),t.style.width=this.wm.opts.iconWidth+"px";var e=document.createElement("img");e.src=this.iconImageURL,e.setAttribute("title",this.titleText),t.appendChild(e),this.taskbarIconImage=e;var n=document.createElement("span");n.innerHTML=this.titleText,t.appendChild(n),this.taskbarIconSpan=n,this.wm.taskbar.appendChild(t),this.components.icon=t,this.wm.opts.resizeIcons&&this.wm._resizeIcons(),Tian.Event.observe(t,"click",Tian.Function.bind(this.onTaskbarIconClick,this)),this.taskbarIcon=t}},_removeTaskbarIcon:function(){Tian.Event.stopObservingElement(this.taskbarIcon),this.taskbarIcon.parentNode.removeChild(this.taskbarIcon),this.taskbarIcon=null,this.wm.opts.resizeIcons&&this.wm._resizeIcons()},onTaskbarIconClick:function(t){Tian.Event.stop(t),this._iconify()},_unload:function(){return"function"!=typeof this.onunload||this.onunload()?(this.detachEvents(),this.onunload=null,this.onselect=null,this.onresize=null,this.onmove=null,this.oniconize=null,this.ondeselect=null,!0):!1},CLASS_NAME:"Tian.Window"}),Tian.Lang={code:null,defaultCode:"en",getCode:function(){return Tian.Lang.code||Tian.Lang.setCode(),Tian.Lang.code},setCode:function(t){var e;t||(t="msie"==Tian.BROWSER?navigator.userLanguage:navigator.language);var n=t.split("-");e=n[0].toLowerCase(),n[1]&&(e=e+"-"+n[1].toUpperCase()),Tian.Lang.code=e?e:Tian.Lang.defaultCode},translate:function(t,e){e||(e=Tian.Lang);var n=Tian.Lang.getCode(),i=e[n],s=i&&i[t];if(!s){var o=n.split("-");o[0]!==n&&(i=e[o[0]],s=i&&i[t]),s||(s=t)}return s},add:function(t,e,n){return"object"!=typeof Tian.Lang[t]&&(Tian.Lang[t]={}),"string"==typeof Tian.Lang[t][e]?!1:(Tian.Lang[t][e]=n,!0)}},Tian.i18n=Tian.Lang.translate,Tian.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(t){return t.target||t.srcElement},isSingleTouch:function(t){return t.touches&&1==t.touches.length},isMultiTouch:function(t){return t.touches&&t.touches.length>1},isLeftClick:function(t){return t.which&&1==t.which||t.button&&1==t.button},isRightClick:function(t){return t.which&&3==t.which||t.button&&2==t.button},getTouchClientXY:function(t){var e=window.pageXOffset||0,n=window.pageYOffset||0,i=t.clientX,s=t.clientY;return 0===t.pageY&&Math.floor(s)>Math.floor(t.pageY)||0===t.pageX&&Math.floor(i)>Math.floor(t.pageX)?(i-=e,s-=n):(s<t.pageY-n||i<t.pageX-e)&&(i=t.pageX-e,s=t.pageY-n),{clientX:i,clientY:s}},stop:function(t,e){e||(t.preventDefault?t.preventDefault():t.returnValue=!1),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},findElement:function(t,e){for(var n=Tian.Event.element(t);n.parentNode&&(!n.tagName||n.tagName.toUpperCase()!=e.toUpperCase());)n=n.parentNode;return n},observe:function(t,e,n,i){var s=Tian.getElement(t);if(i=i||!1,"keypress"==e&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||s.attachEvent)&&(e="keydown"),this.observers||(this.observers={}),!s._eventCacheID){var o="eventCacheID_";s.id&&(o=s.id+"_"+o),s._eventCacheID=Tian.createUniqueID(o)}var r=s._eventCacheID;this.observers[r]||(this.observers[r]=[]),this.observers[r].push({element:s,name:e,observer:n,useCapture:i}),s.addEventListener?s.addEventListener(e,n,i):s.attachEvent&&s.attachEvent("on"+e,n)},stopObservingElement:function(t){var e=Tian.getElement(t),n=e._eventCacheID;this._removeElementObservers(Tian.Event.observers[n])},_removeElementObservers:function(t){if(t)for(var e=t.length-1;e>=0;e--){var n=t[e];Tian.Event.stopObserving.apply(this,[n.element,n.name,n.observer,n.useCapture])}},stopObserving:function(t,e,n,i){i=i||!1;var s=Tian.getElement(t),o=s._eventCacheID;"keypress"==e&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||s.detachEvent)&&(e="keydown");var r=!1,a=Tian.Event.observers[o];if(a)for(var h=0;!r&&h<a.length;){var l=a[h];if(l.name==e&&l.observer==n&&l.useCapture==i){a.splice(h,1),0==a.length&&delete Tian.Event.observers[o],r=!0;break}h++}return r&&(s.removeEventListener?s.removeEventListener(e,n,i):s&&s.detachEvent&&s.detachEvent("on"+e,n)),r},unloadCache:function(){if(Tian.Event&&Tian.Event.observers){for(var t in Tian.Event.observers){var e=Tian.Event.observers[t];Tian.Event._removeElementObservers.apply(this,[e])}Tian.Event.observers=!1}}},Tian.Event.observe(window,"unload",Tian.Event.unloadCache,!1),Tian.Events=Tian.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(t,e,n,i){Tian.extend(this,i),this.object=t,this.fallThrough=n,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=e&&this.attachToElement(e)},destroy:function(){for(var t in this.extensions)"boolean"!=typeof this.extensions[t]&&this.extensions[t].destroy();this.extensions=null,this.element&&(Tian.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&Tian.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},attachToElement:function(t){this.element?Tian.Event.stopObservingElement(this.element):(this.eventHandler=Tian.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=Tian.Function.bind(this.clearMouseCache,this)),this.element=t;for(var e,n=!!window.navigator.msMaxTouchPoints,i=0,s=this.BROWSER_EVENTS.length;s>i;i++)e=this.BROWSER_EVENTS[i],Tian.Event.observe(t,e,this.eventHandler),n&&0===e.indexOf("touch")&&this.addMsTouchListener(t,e,this.eventHandler);Tian.Event.observe(t,"dragstart",Tian.Event.stop)},on:function(t){for(var e in t)"scope"!=e&&t.hasOwnProperty(e)&&this.register(e,t.scope,t[e])},register:function(t,e,n,i){if(t in Tian.Events&&!this.extensions[t]&&(this.extensions[t]=new Tian.Events[t](this)),null!=n){null==e&&(e=this.object);var s=this.listeners[t];s||(s=[],this.listeners[t]=s,this.extensionCount[t]=0);var o={obj:e,func:n};i?(s.splice(this.extensionCount[t],0,o),"object"==typeof i&&i.extension&&this.extensionCount[t]++):s.push(o)}},registerPriority:function(t,e,n){this.register(t,e,n,!0)
},un:function(t){for(var e in t)"scope"!=e&&t.hasOwnProperty(e)&&this.unregister(e,t.scope,t[e])},unregister:function(t,e,n){null==e&&(e=this.object);var i=this.listeners[t];if(null!=i)for(var s=0,o=i.length;o>s;s++)if(i[s].obj==e&&i[s].func==n){i.splice(s,1);break}},remove:function(t){null!=this.listeners[t]&&(this.listeners[t]=[])},emit:function(t,e){var n=this.listeners[t];if(!n||0==n.length)return void 0;null==e&&(e={}),e.object=this.object,e.element=this.element,e.type||(e.type=t),n=n.slice();for(var i,s=0,o=n.length;o>s;s++){var r=n[s];if(i=r.func.apply(r.obj,[e]),void 0!==i&&i===!1)break}return this.fallThrough||Tian.Event.stop(e,!0),i},handleBrowserEvent:function(t){var e=t.type,n=this.listeners[e];if(n&&0!=n.length){var i=t.touches;if(i&&i[0]){for(var s,o=0,r=0,a=i.length,h=0;a>h;++h)s=Tian.Event.getTouchClientXY(i[h]),o+=s.clientX,r+=s.clientY;t.clientX=o/a,t.clientY=r/a}this.includeXY&&(t.xy=this.getMousePosition(t)),this.emit(e,t)}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(t){if(this.includeXY?this.element.hasScrollEvent||(Tian.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var e=Tian.getViewportElement();this.element.scrolls=[window.pageXOffset||e.scrollLeft,window.pageYOffset||e.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=Tian.pagePosition(this.element));var n={x:t.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],y:t.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1]};return n},addMsTouchListener:function(t,e,n){var i=(this.eventHandler,this._msTouches),s=function(t){n(Tian.applyDefaults({stopPropagation:function(){for(var t=i.length-1;t>=0;--t)i[t].stopPropagation()},preventDefault:function(){for(var t=i.length-1;t>=0;--t)i[t].preventDefault()},type:e},t))};switch(e){case"touchstart":return this.addMsTouchListenerStart(t,e,s);case"touchend":return this.addMsTouchListenerEnd(t,e,s);case"touchmove":return this.addMsTouchListenerMove(t,e,s);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(t,e,n){var i=this._msTouches,s=function(t){for(var e=!1,s=0,o=i.length;o>s;++s)if(i[s].pointerId==t.pointerId){e=!0;break}e||i.push(t),t.touches=i.slice(),n(t)};Tian.Event.observe(t,"MSPointerDown",s);var o=function(t){for(var e=0,n=i.length;n>e;++e)if(i[e].pointerId==t.pointerId){i.splice(e,1);break}};Tian.Event.observe(t,"MSPointerUp",o)},addMsTouchListenerMove:function(t,e,n){var i=this._msTouches,s=function(t){if(!(t.pointerType==t.MSPOINTER_TYPE_MOUSE&&0==t.buttons||1==i.length&&i[0].pageX==t.pageX&&i[0].pageY==t.pageY)){for(var e=0,s=i.length;s>e;++e)if(i[e].pointerId==t.pointerId){i[e]=t;break}t.touches=i.slice(),n(t)}};Tian.Event.observe(t,"MSPointerMove",s)},addMsTouchListenerEnd:function(t,e,n){var i=this._msTouches,s=function(t){for(var e=0,s=i.length;s>e;++e)if(i[e].pointerId==t.pointerId){i.splice(e,1);break}t.touches=i.slice(),n(t)};Tian.Event.observe(t,"MSPointerUp",s)},CLASS_NAME:"Tian.Events"}),Tian.Winager=Tian.Class({taskbar:null,windows:null,winSelected:null,winDragging:null,mouse:null,opts:null,initialize:function(t){this.windows=[],this.mouse={cur:{x:0,y:0},click:{x:0,y:0}},this.opts={classWindow:"txWindow",classActiveWindow:"txWindowActive",classContent:"safari"===Tian.BROWSER?"txWinContentSafari":"txWinContent",classFrame:"txWinFrame",classTitle:"txWinTitle txWidgetNoSelect",classIcon:"txWinTaskBarIcon",classActiveIcon:"txWinTaskBarIconActive",baseZIndex:5e3,container:null,iconImageURL:"",defaultX:32,defaultY:32,defaultWidth:500,defaultHeight:300,shiftOffset:32,movable:!0,containerBoundaries:64,iconWidth:36,resizeIcons:!0},Tian.extend(this.opts,t),this.opts.container||(this.opts.container=document.body);var e=document.createElement("div");e.className="txWinTaskbar txWidgetNoSelect",this.opts.container.appendChild(e),this.taskbar=e,Tian.Event.observe(window,"resize",Tian.Function.bind(this.checkResize,this))},destroy:function(){Tian.Event.stopObserving(window,"resize",Tian.Function.bind(this.checkResize,this));for(var t=this.getAllWindows(),e=0;e<t.length;e++)t[e].close(),t[e]=void 0},checkResize:function(){for(var t=0;t<this.windows.length;t++){var e=this.windows[t];if("maximized"==e.state){var n=e.win.offsetWidth-parseInt(e.win.style.width),i=e.win.offsetHeight-parseInt(e.win.style.height),s=e.getContainerWidth()-n,o=e.getContainerHeight()-i;e._setSize(s,o,!1,"resize")}}this._resizeIcons()},_resizeIcons:function(){var t,e=function(t,e){var n=parseInt(Tian.getStyle(t,e));return isNaN(n)?0:n},n=[];for(t=0;t<this.windows.length;t++){var i=this.windows[t];i.taskbarIcon&&i.taskbarIcon.parentNode==this.taskbar&&n.push(i.taskbarIcon)}if(!(n.length<1)){var s=this.taskbar.clientWidth-e(this.taskbar,"padding-left")-e(this.taskbar,"padding-right")-1,o=parseInt(s/n.length);for(t=0;t<n.length;t++){var r=n[t],a=r.offsetWidth+e(r,"margin-left")+e(r,"margin-right")-e(r,"width");r.style.width=this.opts.iconWidth+a>o?o-a-1+"px":this.opts.iconWidth+"px"}}},createWindow:function(t){if(t=t||{},t.id&&null!=this.getWindow(t.id))return null;var e=t.container||this.opts.container,n=t.state||this.opts.defaultState,i=new Tian.Window(t,this);if(i.win=document.createElement("div"),i.content=document.createElement("div"),this.opts.shiftOffset>0){var s;do for(s=0;s<this.windows.length;s++){var o=this.windows[s];if(!(o.x!==i.x&&o.userX!==i.x||o.y!==i.y&&o.userY!==i.y)){i.x+=this.opts.shiftOffset,i.y+=this.opts.shiftOffset,i.x+i.w>this.getContainerWidth()&&(i.x=this.opts.defaultX),i.y+i.h>this.getContainerHeight()&&(i.y=this.opts.defaultY);break}}while(s!=this.windows.length)}return i.userX=i.x,i.userY=i.y,i.win.className=this.opts.classWindow,i.win.style.cssText="z-index:"+this.opts.baseZIndex+";position:absolute;top:"+i.y+"px;left:"+i.x+"px;",i.content.className=this.opts.classContent,i.content.style.cssText="width:0px;height:0px",i.title=document.createElement("div"),i.title.className=this.opts.classTitle,i.titleSpan=document.createElement("div"),i.titleSpan.className="txWinTitleText",i.titleSpan.innerHTML=i.titleText,i.title.appendChild(i.titleSpan),i.components.close=document.createElement("div"),i.components.close.className="txWinCloseBox",i.title.appendChild(i.components.close),i.components.maximizer=document.createElement("div"),i.components.maximizer.className="txWinMaxBox",i.title.appendChild(i.components.maximizer),this.taskbar&&(i.components.iconizer=document.createElement("div"),i.components.iconizer.className="txWinMinBox",i.title.appendChild(i.components.iconizer)),i.loading=document.createElement("div"),i.loading.className="txWinLoading",i.title.appendChild(i.loading),i.components.loading=i.loading,i.components.zoomer=document.createElement("div"),i.components.zoomer.className="txWinZoomBox",i.title.appendChild(i.components.zoomer),i.win.appendChild(i.title),i.components.titlebar=i.title,i.win.appendChild(i.content),i.components.content=i.content,e.appendChild(i.win),i.components.window=i.win,i._setSize(i.w,i.h,!1,""),this.windows.push(i),this.taskbar&&i._createTaskbarIcon(),this._selectWindow(i,!0),"window"!=n&&i.setState(n),i.attachEvents(),i.closeConfirm=t.closeConfirm||"",i},getWindow:function(t){for(var e,e=0;e<this.windows.length;e++){var n=this.windows[e];if(n.id==t)return n}return null},getSelectedWindow:function(){return this.selectedWindow},getAllWindows:function(){for(var t=[],e=this.windows.length-1;e>=0;e--)t.push(this.windows[e]);return t},getContainerHeight:function(){return this.opts.container===document.body?this.getBodySize().height:this.opts.container.clientHeight},getContainerWidth:function(){return this.opts.container==document.body?this.getBodySize().width:this.opts.container.clientWidth},_getFirstVisibleWindow:function(){for(var t=this.windows.length-1;t>=0;t--){var e=this.windows[t];if("hidden"!=e.win.style.visibility)return e}return null},_selectWindow:function(t){if(t!=this.selectedWindow){if(this.selectedWindow&&this.selectedWindow.ondeselect&&this.selectedWindow.ondeselect(),!t.alwaysOnTop)for(var e=0;e<this.windows.length;e++)if(this.windows[e]==t){for(var n=this.windows.splice(e,1),i=this.windows.length-1;i>=0&&this.windows[i].alwaysOnTop;i--);this.windows.splice(i+1,0,n[0]);break}for(var e=0;e<this.windows.length;e++){var s=this.windows[e],o=s===t;o&&(t.win.style.display="",t.win.style.visibility="visible"),s.win.style.zIndex=this.opts.baseZIndex+e,s.win.className=o?this.opts.classActiveWindow:this.opts.classWindow;var r=s.taskbarIcon;r&&(r.className=o?this.opts.classActiveIcon:this.opts.classIcon);var a=s.components.close;a&&(a.className=o?"txWinCloseBoxActive":"txWinCloseBox");var h=s.components.iconizer;h&&(h.className=o?"txWinMinBoxActive":"txWinMinBox");var l=s.components.maximizer;l&&(l.className=o?"txWinMaxBoxActive":"txWinMaxBox");var u=s.components.zoomer;u&&(u.className=o?"txWinZoomBoxActive":"txWinZoomBox")}"window"!==t.state&&(t.state=t.prvState,t.prvState=null),this.selectedWindow=t,"function"==typeof t.onselect&&t.onselect()}},_destroyWindow:function(t){for(var e=0;e<this.windows.length;e++){var n=this.windows[e];if(n==t){if(!n._unload(!1))return!1;n.getContainer().removeChild(n.win),null!=n.taskbarIcon&&n._removeTaskbarIcon();for(var i=this.windows.splice(e,1)[0],s=0;s<this.windows.length;s++)this.windows[s].win.style.zIndex=this.opts.baseZIndex+s;"function"==typeof i.onclose&&(i.onclose(),i.onclose=null),i=null;var o=this._getFirstVisibleWindow();return o&&o.select(),void 0}}return null},handleBrowserEvent:function(t){var e=t.touches;if(e&&e[0]){for(var n,i=0,s=0,o=e.length,r=0;o>r;++r)n=Tian.Event.getTouchClientXY(e[r]),i+=n.clientX,s+=n.clientY;t.clientX=i/o,t.clientY=s/o}return t},getEventXY:function(t,e){if(t=this.handleBrowserEvent(t),!e.scrolls){var n=Tian.getViewportElement();e.scrolls=[n.scrollLeft,n.scrollTop]}e.lefttop||(e.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),e.offsets||(e.offsets=Tian.pagePosition(e));var i={x:t.clientX+e.scrolls[0]-e.offsets[0]-e.lefttop[0],y:t.clientY+e.scrolls[1]-e.offsets[1]-e.lefttop[1]};return i},getBodySize:function(){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return{width:t,height:e}},CLASS_NAME:"Tian.Winager"}),Tian.Widget=Tian.Class({div:null,title:null,baseZIndex:1e3,os:null,initialize:function(){},draw:function(){return this.div=document.createElement("div"),this.div.id=Tian.createUniqueID("txWidgetID_"),this.div.style.zIndex=this.baseZIndex+parseInt(this.div.id.slice(11),10),this.title&&(this.div.title=this.title),this.div},destroy:function(){var t=this.div.parentNode;t&&t.removeChild&&t.removeChild(this.div),this.div=null,this.os=null},setOS:function(t){this.os||(this.os=t)},getOS:function(){return this.os},CLASS_NAME:"Tian.Widget"}),function($){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,i,s,o,r,a=gap,h=e[t];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(t)),"function"==typeof rep&&(h=rep.call(e,t,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(h)){for(o=h.length,n=0;o>n;n+=1)r[n]=str(n,h)||"null";return s=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+a+"]":"["+r.join(",")+"]",gap=a,s}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],s=str(i,h),s&&r.push(quote(i)+(gap?": ":":")+s));else for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(s=str(i,h),s&&r.push(quote(i)+(gap?": ":":")+s));return s=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+a+"}":"{"+r.join(",")+"}",gap=a,s}}$.JSON||($.JSON={}),"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof $.JSON.stringify&&($.JSON.stringify=function(t,e,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("Tian.JSON.stringify");return str("",{"":t})}),"function"!=typeof $.JSON.parse&&($.JSON.parse=function(text,reviver){function walk(t,e){var n,i,s=t[e];if(s&&"object"==typeof s)for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i=walk(s,n),void 0!==i?s[n]=i:delete s[n]);return reviver.call(t,e,s)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("Tian.JSON.parse")})}(Tian),function(t){function e(){var t=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),t=!0,window.localStorage.removeItem("_tmptest")}catch(e){}if(t)try{window.localStorage&&(h=window.localStorage,c="localStorage")}catch(i){}else if("globalStorage"in window)try{window.globalStorage&&(h=window.globalStorage[window.location.hostname],c="globalStorage")}catch(s){}else{if(l=document.createElement("link"),!l.addBehavior)return l=null,void 0;l.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(l),l.load("jStorage");var r="{}";try{r=l.getAttribute("jStorage")}catch(a){}h.jStorage=r,c="userDataBehavior"}n(),o()}function n(){if(h.jStorage)try{a=t.JSON.parse(String(h.jStorage))}catch(e){h.jStorage="{}"}else h.jStorage="{}";u=h.jStorage?String(h.jStorage).length:0}function i(){try{h.jStorage=t.JSON.stringify(a),l&&(l.setAttribute("jStorage",h.jStorage),l.save("jStorage")),u=h.jStorage?String(h.jStorage).length:0}catch(e){}}function s(t){if(!t||"string"!=typeof t&&"number"!=typeof t)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==t)throw new TypeError("Reserved key name");return!0}function o(){var t,e,n,s=1/0,h=!1;if(clearTimeout(r),a.__jstorage_meta&&"object"==typeof a.__jstorage_meta.TTL){t=+new Date,n=a.__jstorage_meta.TTL;for(e in n)n.hasOwnProperty(e)&&(n[e]<=t?(delete n[e],delete a[e],h=!0):n[e]<s&&(s=n[e]));1/0!=s&&(r=setTimeout(o,s-t)),h&&i()}}var r,a={},h={jStorage:"{}"},l=null,u=0,c=!1;t.DB={VERSION:"2012-11-29",set:function(e,n,o){return s(e),o=o||{},"function"==typeof n?n=null:n&&"object"==typeof n&&(n=t.JSON.parse(t.JSON.stringify(n))),a[e]=n,isNaN(o.TTL)?i():this.setTTL(e,o.TTL),n},get:function(t,e){return s(t),t in a?a[t]:"undefined"==typeof e?null:e},deleteKey:function(t){return s(t),t in a?(delete a[t],a.__jstorage_meta&&"object"==typeof a.__jstorage_meta.TTL&&t in a.__jstorage_meta.TTL&&delete a.__jstorage_meta.TTL[t],i(),!0):!1},setTTL:function(t,e){var n=+new Date;return s(t),e=Number(e)||0,t in a?(a.__jstorage_meta||(a.__jstorage_meta={}),a.__jstorage_meta.TTL||(a.__jstorage_meta.TTL={}),e>0?a.__jstorage_meta.TTL[t]=n+e:delete a.__jstorage_meta.TTL[t],i(),o(),!0):!1},flush:function(){return a={},i(),!0},storageObj:function(){function t(){}return t.prototype=a,new t},index:function(){var t,e=[];for(t in a)a.hasOwnProperty(t)&&"__jstorage_meta"!=t&&e.push(t);return e},storageSize:function(){return u},currentBackend:function(){return c},storageAvailable:function(){return!!c},reInit:function(){var t,e;if(l&&l.addBehavior){t=document.createElement("link"),l.parentNode.replaceChild(t,l),l=t,l.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(l),l.load("jStorage"),e="{}";try{e=l.getAttribute("jStorage")}catch(i){}h.jStorage=e,c="userDataBehavior"}n()}},e()}(Tian),Tian.App=Tian.Class({os:null,div:null,childTitle:null,childIcon:null,title:"",icon:"",page:"",window:null,width:450,height:250,xdomain:!1,theApp:null,initialize:function(t){Tian.extend(this,t),this.title?"object"==typeof this.title?this.title=Tian.i18n("app",this.title):this.title+="":this.title="Unknwon App"},destroy:function(){this.window&&(this.window.close(),this.window=null),Tian.Event.stopObservingElement(this.div),this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.div=null,this.childIcon=null,this.childTitle=null,this.os=null},draw:function(){return!this.icon&&this.os&&(this.icon=this.os.getImagePath()+"default_app_icon.png"),null==this.div&&(this.div=document.createElement("div")),this.div.className="txApp",this.icon&&(this.childIcon=document.createElement("img"),this.childIcon.src=this.icon,this.div.appendChild(this.childIcon)),this.title&&(this.childTitle=document.createElement("p"),this.childTitle.innerHTML=this.title,this.div.appendChild(this.childTitle)),Tian.Event.observe(this.div,"click",Tian.Function.bindAsEventListener(this.onOpen,this)),this.div},setOS:function(t){this.os||(this.os=t)},getOS:function(){return this.os},onOpen:function(t){t&&Tian.Event.stop(t),this.open()},open:function(){if(this.window)return this.window.select(),void 0;if(this.os){var t=this.os.getWindowManager(),e=null,n=null,i=null,s=null;e=Tian.DB.get(Tian.md5(this.title+"_ww")),n=Tian.DB.get(Tian.md5(this.title+"_wh")),i=Tian.DB.get(Tian.md5(this.title+"_wx")),s=Tian.DB.get(Tian.md5(this.title+"_wy")),this.window=t.createWindow({title:this.title,state:"window",width:e?e:this.width,height:n?n:this.height,x:i?i:null,y:s?s:null,iconImageURL:this.icon}),this.window.onclose=Tian.Function.bind(this.onWinClose,this),this.window.onmove=Tian.Function.bind(this.onWinMove,this),this.window.onresize=Tian.Function.bind(this.onWinResize,this),this.page&&this.window.loadUrlX(this.page,Tian.Function.bind(this.onWinLoad,this))}},setTitle:function(t){t&&t!==this.title&&(this.title=t,this.childTitle.innerHTML=t,this.window&&this.window.setTitle(t))},getTitle:function(){return this.title},setIcon:function(t){t&&t!==this.icon&&(this.icon=t,this.childIcon.src=t,this.window&&this.window.setIconImage(t))},onWinLoad:function(t){if(t){var e=t.getElement("theFrame");if(!this.xdomain&&e&&e.contentWindow&&"function"==typeof e.contentWindow.tianMain){this.theApp=e.contentWindow.tianMain.call(e.contentWindow,{app:this,win:t});var n=this.window,i=function(){n.select()};e.contentWindow.onclick=i}}},onWinClose:function(){this.window=null,this.theApp=null},onWinMove:function(t,e){Tian.DB.set(Tian.md5(this.title+"_wx"),t),Tian.DB.set(Tian.md5(this.title+"_wy"),e)},onWinResize:function(t,e,n){switch(n){case"resize":Tian.DB.set(Tian.md5(this.title+"_ww"),t),Tian.DB.set(Tian.md5(this.title+"_wh"),e);break;case"maximize":break;case"restore":}},CLASS_NAME:"Tian.App"}),Tian.Widget.MainPanel=Tian.Class(Tian.Widget,{mainDiv:null,window:null,width:540,height:300,apps:null,initialize:function(){Tian.Widget.prototype.initialize.apply(this,arguments),this.apps=[]},draw:function(){return Tian.Widget.prototype.draw.apply(this,arguments),this.div.className="txWidgetMainPanel txWidgetNoSelect",this.mainDiv=document.createElement("div"),this.mainDiv.className="txWidgetMainPanelContent",Tian.Event.observe(this.div,"click",Tian.Function.bindAsEventListener(this.onClick,this)),this.div},destroy:function(){if(this.apps){for(var t=this.apps.length-1;t>=0;t--)this.delApp(this.apps[t]),this.apps[t].destroy();this.apps=null}this.window&&(this.window.close(),this.window=null),this.mainDiv&&(this.mainDiv=null),Tian.Event.stopObservingElement(this.div),Tian.Widget.prototype.destroy.apply(this,arguments)},onClick:function(t){t&&Tian.Event.stop(t),this.open()},onWinClose:function(){this.window=null},onWinMove:function(t,e){Tian.DB.set(Tian.md5(this.CLASS_NAME+"_wx"),t),Tian.DB.set(Tian.md5(this.CLASS_NAME+"_wy"),e)},onWinResize:function(t,e,n){switch(n){case"resize":Tian.DB.set(Tian.md5(this.CLASS_NAME+"_ww"),t),Tian.DB.set(Tian.md5(this.CLASS_NAME+"_wh"),e);break;case"maximize":break;case"restore":}},addApp:function(t){t instanceof Tian.App&&(t.setOS(this.os),this.mainDiv.appendChild(t.draw()),this.apps.push(t))},delApp:function(t){t instanceof Tian.App&&(this.mainDiv.removeChild(t.div),Tian.Array.removeItem(this.apps,t),t.window&&(t.window.close(),t.window=null))},clearApps:function(){if(this.apps){for(var t=this.apps.length-1;t>=0;t--)this.delApp(this.apps[t]),this.apps[t].destroy();this.apps=[]}},getAllApps:function(){return this.apps},open:function(){if(this.window)return this.window.select(),void 0;if(this.os){var t=this.os.getWindowManager(),e=null,n=null,i=null,s=null;e=Tian.DB.get(Tian.md5(this.CLASS_NAME+"_ww")),n=Tian.DB.get(Tian.md5(this.CLASS_NAME+"_wh")),i=Tian.DB.get(Tian.md5(this.CLASS_NAME+"_wx")),s=Tian.DB.get(Tian.md5(this.CLASS_NAME+"_wy")),this.window=t.createWindow({title:this.title,centered:!0,state:"window",width:e?e:this.width,height:n?n:this.height,x:i?i:null,y:s?s:null,iconImageURL:this.getOS().getImagePath()+"main_icon.png"}),this.window.getComponent("content").innerHTML="",this.window.getComponent("content").appendChild(this.mainDiv),this.window.getComponent("content").style.overflow="auto",this.window.onclose=Tian.Function.bind(this.onWinClose,this),this.window.onmove=Tian.Function.bind(this.onWinMove,this),this.window.onresize=Tian.Function.bind(this.onWinResize,this)}},CLASS_NAME:"Tian.Widget.MainPanel"}),Tian.Widget.TitleBar=Tian.Class(Tian.Widget,{spanTitle:null,spanNotify:null,notifications:null,initialize:function(){Tian.Widget.prototype.initialize.apply(this,arguments),this.notifications=[]},draw:function(){return Tian.Widget.prototype.draw.apply(this,arguments),this.div.className="txWidgetTitleBar txWidgetNoSelect",this.spanTitle=document.createElement("span"),this.spanTitle.className="txWidgetTitleBarTitle",this.div.appendChild(this.spanTitle),this.spanNotify=document.createElement("span"),this.spanNotify.className="txWidgetTitleBarNotification",this.div.appendChild(this.spanNotify),this.div},destroy:function(){this.os&&this.os.events.unregister("notify",this,this.onNotify),this.notifications=null,Tian.Widget.prototype.destroy.apply(this,arguments)},setOS:function(){Tian.Widget.prototype.setOS.apply(this,arguments),this.os&&(this.spanTitle.innerHTML=this.os.title,this.os.events.register("notify",this,this.onNotify))},onNotify:function(t){t&&t.data&&(this.spanNotify.innerHTML=t.data.notification,this.notifications.push(t.data),this.notifications.length>999&&this.notifications.shift())},clearNotifications:function(){this.spanNotify.innerHTML="",this.notifications=[]},CLASS_NAME:"Tian.Widget.TitleBar"}),Tian.Widget.Taskbar=Tian.Class(Tian.Widget,{draw:function(){return Tian.Widget.prototype.draw.apply(this,arguments),this.div&&(this.div.className="txWidgetTaskbar txWidgetNoSelect"),this.div},CLASS_NAME:"Tian.Widget.Taskbar"}),Tian.OS=Tian.Class({title:"",div:null,mainPanel:null,titleBar:null,taskbar:null,widgets:null,wm:null,theme:"default",themeHost:"",imagePath:"",events:null,initialize:function(t,e){this.title=t?t:"TianOX","string"==typeof e&&e.length>0&&("/"!=e.charAt(e.length-1)&&(e+="/"),this.themeHost=e)},boot:function(){var t=document.getElementsByTagName("body")[0]||document.documentElement;this.div=document.createElement("div"),this.div.className="txOS",t.insertBefore(this.div,t.firstChild),this.themeHost&&(Tian.requireCSS(this.themeHost+this.theme+"/style.css"),this.setImagePath()),this.events=new Tian.Events(this,null,!0),this.createMainPanel(),this.createTitleBar(),this.createTaskbar(),this.createWindowManager()},exit:function(){this.wm.destroy(),this.wm=null,this.titleBar.destroy(),this.titleBar=null,this.taskbar.destroy(),this.taskbar=null,this.mainPanel.destroy(),this.mainPanel=null,this.events.destroy(),this.events=null},createMainPanel:function(){this.mainPanel=new Tian.Widget.MainPanel,this.div.appendChild(this.mainPanel.draw()),this.mainPanel.setOS(this)},createTitleBar:function(){this.titleBar=new Tian.Widget.TitleBar,this.div.appendChild(this.titleBar.draw()),this.titleBar.setOS(this)},createTaskbar:function(){this.taskbar=new Tian.Widget.Taskbar,this.div.appendChild(this.taskbar.draw()),this.taskbar.setOS(this)},createWindowManager:function(){this.wm=new Tian.Winager({container:this.div,taskbar:null!==this.taskbar?this.taskbar.div:null,defaultX:50,defaultY:35,iconWidth:36,cacheXHR:!0})},notify:function(t){var e=new Date;this.events.emit("notify",{data:{timestamp:e.getTime(),notification:""+t}})},changeTheme:function(t){var e,n;t&&t!=this.theme&&(e=this.themeHost+t+"/style.css",n=this.themeHost+this.theme+"/style.css",Tian.replaceCSS(n,e),this.theme=t,this.setImagePath())},setImagePath:function(t){this.imagePath=t?t:this.themeHost+this.theme+"/img/"},getImagePath:function(){return this.imagePath||this.setImagePath(),this.imagePath},getWindowManager:function(){return this.wm},getEvents:function(){return this.events},getMainPanel:function(){return this.mainPanel},getTitleBar:function(){return this.titleBar},getTheme:function(){return this.theme},CLASS_NAME:"Tian.OS"}),Tian.Embedded=Tian.Class({theWin:null,theApp:null,dictionaries:null,closeConfirm:"",initialize:function(t){this.theApp=t&&t.app?t.app:null;var e=t&&t.win?t.win:null;e&&(e.setCloseConfirm(this.closeConfirm),e.onselect=Tian.Function.bind(this.onSelect,this),e.ondeselect=Tian.Function.bind(this.onDeselect,this),e.oniconize=Tian.Function.bind(this.onIconize,this),e.onhttperror=Tian.Function.bind(this.onHttpError,this),e.onunload=Tian.Function.bind(this.onUnload,this)),this.theWin=e,this.onRun()},destroy:function(){this.onDestroy(),this.theWin=null,this.theApp=null,this.dictionaries=null},onRun:function(){},onDestroy:function(){},i18n:function(t){return Tian.i18n(t,this.dictionaries)},setTitle:function(t){this.theApp&&this.theApp.setTitle(t)},setIcon:function(t){this.theApp&&this.theApp.setIcon(t)},getTitle:function(){return this.theApp?this.theApp.title:""},getOS:function(){return this.theApp?this.theApp.getOS():null},onSelect:function(){},onDeselect:function(){},onIconize:function(){},onHttpError:function(){},onUnload:function(){return this.destroy(),!0},CLASS_NAME:"Tian.Embedded"}),Tian.Number={dsep:".",tsep:",",limitSigDigs:function(t,e){var n=0;return e>0&&(n=parseFloat(t.toPrecision(e))),n},limitFixDigs:function(t,e){var n=0;return"number"==typeof e&&(n=parseFloat(t.toFixed(e))),n},format:function(t,e,n,i){e="undefined"!=typeof e?e:0,n="undefined"!=typeof n?n:Tian.Number.tsep,i="undefined"!=typeof i?i:Tian.Number.dsep,null!=e&&(t=parseFloat(t.toFixed(e)));var s=t.toString().split(".");1==s.length&&null==e&&(e=0);var o=s[0];if(n)for(var r=/(-?[0-9]+)([0-9]{3})/;r.test(o);)o=o.replace(r,"$1"+n+"$2");var a;if(0==e)a=o;else{var h=s.length>1?s[1]:"0";null!=e&&(h+=new Array(e-h.length+1).join("0")),a=o+i+h}return a},zeroize:function(t,e){e||(e=2),t+="";for(var n=0,i="";n<e-t.length;n++)i+="0";return i+t}},Tian.Date={format:function(t,e){if(!e)return t.toString();var n=/"[^"]*"|'[^']*'|\b(?:d{1,4}|m{1,4}|yy(?:yy)?|([hHMSlLtT])\1?|[lLZ])\b/g;return e.replace(n,function(e){switch(e){case"d":return t.getDate();case"dd":return Tian.Number.zeroize(t.getDate());case"m":return t.getMonth()+1;case"mm":return Tian.Number.zeroize(t.getMonth()+1);case"yy":return String(t.getFullYear()).substr(2);case"yyyy":return t.getFullYear();case"h":return t.getHours()%12||12;case"hh":return Tian.Number.zeroize(t.getHours()%12||12);case"H":return t.getHours();case"HH":return Tian.Number.zeroize(t.getHours());case"M":return t.getMinutes();case"MM":return Tian.Number.zeroize(t.getMinutes());case"S":return t.getSeconds();case"SS":return Tian.Number.zeroize(t.getSeconds());case"l":var n=t.getMilliseconds();return n>99&&(n=Math.round(n/10)),Tian.Number.zeroize(n);case"L":return Tian.Number.zeroize(t.getMilliseconds(),3);default:return e.substr(1,e.length-2)}})},doy:function(t){t||(t=new Date);var e=new Date(t.getFullYear(),0,1);return Math.ceil((t-e)/864e5)},parse:function(t){var e,n=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,i=t.match(n);if(i&&(i[1]||i[7])){var s=parseInt(i[1],10)||0,o=parseInt(i[2],10)-1||0,r=parseInt(i[3],10)||1;e=new Date(Date.UTC(s,o,r));var a=i[7];if(a){var h=parseInt(i[4],10),l=parseInt(i[5],10),u=parseFloat(i[6]),c=0|u,f=Math.round(1e3*(u-c));if(e.setUTCHours(h,l,c,f),"Z"!==a){var d=parseInt(a,10),p=parseInt(i[8],10)||0,m=-1e3*(3600*d+60*p);e=new Date(e.getTime()+m)}}}else e=new Date("invalid");return e}},Tian.require=function(t,e,n){n=n||document;var i=n.getElementsByTagName("head")[0]||n.documentElement;if(!i)return e&&e.call(null,"error"),void 0;"string"==typeof t&&(t=[t]);for(var s=0,o=[],r=[],a=0,h=t.length;h>a;a++)"string"==typeof t[a]&&(o[a]=!1,r[a]=n.createElement("script"),r[a].charset="utf-8",r[a].src=t[a],r[a].onload=r[a].onreadystatechange=function(n){return function(){o[n]||r[n].readyState&&!/loaded|complete/.test(r[n].readyState)||(o[n]=!0,s+=1,r[n].onload=r[n].onreadystatechange=null,i&&r[n].parentNode&&i.removeChild(r[n]),r[n]=void 0,s===t.length&&e&&e.call(null))}}(a),i.insertBefore(r[a],i.firstChild))},Tian.requireCSS=function(t,e,n){n=n||document;for(var i=!1,s=n.getElementsByTagName("link"),o=0;o<s.length;o++)if(s[o]&&s[o].href==t){i=!0;break}if(!i){var r=n.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=t;var a=n.getElementsByTagName("head")[0]||n.documentElement;a.insertBefore(r,a.firstChild)}e&&e.call(null)},Tian.removeCSS=function(t,e,n){n=n||document;for(var i=n.getElementsByTagName("link"),s=i.length;s>=0;s--)i[s]&&null!=i[s].href&&-1!=i[s].href.indexOf(t)&&i[s].parentNode&&i[s].parentNode.removeChild(i[s]);e&&e.call(null)},Tian.replaceCSS=function(t,e,n,i){i=i||document,Tian.requireCSS(e,i),Tian.removeCSS(t,i),n&&n.call(null)},function(){for(var t=document.getElementsByTagName("script"),e=!1,n=0;n<t.length;n++)if(e=t[n].getAttribute("data-boot"))return Tian.require(e),void 0}(),function(t){var e=function(t){return"number"==typeof t&&Math.floor(t)===t&&t>=0&&255>=t?16>t?"0"+t.toString(16):t.toString(16):""},n=function(t){var n,i="",s=t.length;for(n=0;s>n;n+=1)i+=e(t[n]);return i},i=function(t){t=t.replace(/[^A-Fa-f0-9]/g,"");for(var e=[],n=0,i=t.length;i>n;n+=2)e.push(parseInt(t.slice(n,n+2),16));return e},s=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],o=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],r=function(t){return t>=0&&t<o.length?o[t]:-1},a=function(t){for(var e=t&&t.length?t.length:0,n=Math.floor(e/3),i=e-3*n,o="",r=0,a=0;n>a;a++){var h=255&t[r++],l=255&t[r++],u=255&t[r++];
o+=s[h>>2],o+=s[h<<4&63|l>>4],o+=s[l<<2&63|u>>6],o+=s[63&u]}if(1==i){var h=255&t[r++];o+=s[h>>2],o+=s[h<<4&63],o+="=="}else if(2==i){var h=255&t[r++],l=255&t[r++];o+=s[h>>2],o+=s[h<<4&63|l>>4],o+=s[l<<2&63],o+="="}return o},h=function(t){var e=t&&t.length?t.length:0,n=[],i=Math.floor(e/4);if(4*i!==e)return n;var s=0;e>0&&("="===t.charAt(e-1)&&(s+=1,i-=1),"="===t.charAt(e-2)&&(s+=1));for(var o=0,a=0;i>a;a++){var h=r(t.charCodeAt(o++)),l=r(t.charCodeAt(o++)),u=r(t.charCodeAt(o++)),c=r(t.charCodeAt(o++));n.push(255&(h<<2|l>>4)),n.push(255&(l<<4|u>>2)),n.push(255&(u<<6|c))}if(1==s){var h=r(t.charCodeAt(o++)),l=r(t.charCodeAt(o++)),u=r(t.charCodeAt(o++));n.push(255&(h<<2|l>>4)),n.push(255&(l<<4|u>>2))}else if(2==s){var h=r(t.charCodeAt(o++)),l=r(t.charCodeAt(o++));n.push(255&(h<<2|l>>4))}return n},l=function(t,e,n,i,s){var o,r,a=8*s-i-1,h=(1<<a)-1,l=h>>1,u=-7,c=n?0:s-1,f=n?1:-1,d=t[e+c];for(c+=f,o=d&(1<<-u)-1,d>>=-u,u+=a;u>0;o=256*o+t[e+c],c+=f,u-=8);for(r=o&(1<<-u)-1,o>>=-u,u+=i;u>0;r=256*r+t[e+c],c+=f,u-=8);if(0===o)o=1-l;else{if(o===h)return r?0/0:1/0*(d?-1:1);r+=Math.pow(2,i),o-=l}return(d?-1:1)*r*Math.pow(2,o-i)},u=function(t,e,n,i,s,o){var r,a,h,l=8*o-s-1,u=(1<<l)-1,c=u>>1,f=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?o-1:0,p=i?-1:1,m=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(a=isNaN(e)?1:0,r=u):(r=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-r))<1&&(r--,h*=2),e+=r+c>=1?f/h:f*Math.pow(2,1-c),e*h>=2&&(r++,h/=2),r+c>=u?(a=0,r=u):r+c>=1?(a=(e*h-1)*Math.pow(2,s),r+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,s),r=0));s>=8;t[n+d]=255&a,d+=p,a/=256,s-=8);for(r=r<<s|a,l+=s;l>0;t[n+d]=255&r,d+=p,r/=256,l-=8);t[n+d-p]|=128*m};t.Buffer=t.Class({buffer:null,initialize:function(e,n){var s,o;if("number"==typeof e)for(this.buffer=[],o=parseInt(e,10),s=0;o>s;s+=1)this.buffer.push(0);else if(t.Array.isArray(e))this.buffer=e;else if("string"==typeof e)switch(n){case"hex":this.buffer=i(e);break;case"base64":this.buffer=h(e);break;default:this.buffer=i(e)}else this.buffer=[]},getLength:function(){return this.buffer.length},toString:function(t){switch(t){case"hex":return n(this.buffer);case"base64":return a(this.buffer);default:return n(this.buffer)}return""},verify:function(t,e){switch(e){case"offset":return"number"==typeof t&&t>=0&&t<this.buffer.length&&Math.floor(t)===t;case"char":return"string"==typeof t&&1===t.length&&t.charCodeAt(0)<128;case"string":return"string"==typeof t&&t.length>0;case"uint8":return"number"==typeof t&&t>=0&&255>=t&&Math.floor(t)===t;case"uint16":return"number"==typeof t&&t>=0&&65535>=t&&Math.floor(t)===t;case"uint32":return"number"==typeof t&&t>=0&&4294967295>=t&&Math.floor(t)===t;case"int8":return"number"==typeof t&&t>=-128&&127>=t&&Math.floor(t)===t;case"int16":return"number"==typeof t&&t>=-32768&&32767>=t&&Math.floor(t)===t;case"int32":return"number"==typeof t&&t>=-2147483648&&2147483647>=t&&Math.floor(t)===t;case"float":return"number"==typeof t&&t>=-3.4028234663852886e38&&3.4028234663852886e38>=t;case"double":return"number"==typeof t&&t>=-1.7976931348623157e308&&1.7976931348623157e308>=t;default:return!1}},getChar:function(t){return this.verify(t,"offset")?String.fromCharCode(this.buffer[t]):void 0},setChar:function(t,e){return this.verify(t,"char")&&this.verify(e,"offset")?(this.buffer[e]=t.charCodeAt(0),!0):!1},getString:function(t,e){var n,i,s="";if(this.verify(t,"offset")&&this.verify(t+e-1,"offset")){for(e=t+e,n=t;e>n;)i=this.buffer[n++],128>i?s+=String.fromCharCode(i):224>i?s+=String.fromCharCode((31&i)<<6|(63&this.buffer[n++])<<0):240>i?s+=String.fromCharCode((15&i)<<12|(63&this.buffer[n++])<<6|(63&this.buffer[n++])<<0):248>i?s+=String.fromCharCode((7&i)<<18|(63&this.buffer[n++])<<12|(63&this.buffer[n++])<<6|(63&this.buffer[n++])<<0):252>i?s+=String.fromCharCode((3&i)<<24|(63&this.buffer[n++])<<18|(63&this.buffer[n++])<<12|(63&this.buffer[n++])<<6|(63&this.buffer[n++])<<0):254>i&&(s+=String.fromCharCode((1&i)<<30|(63&this.buffer[n++])<<24|(63&this.buffer[n++])<<18|(63&this.buffer[n++])<<12|(63&this.buffer[n++])<<6|(63&this.buffer[n++])<<0));return s}return void 0},setString:function(t,e){var n,i,s,o=[];if(!this.verify(t,"string")||!this.verify(e,"offset"))return!1;for(n=0,i=t.length;i>n;n++)s=t.charCodeAt(n),128>s?o.push(s):2048>s?(o.push(192|(1984&s)>>>6),o.push(128|63&s)):65536>s?(o.push(224|(61440&s)>>>12),o.push(128|(4032&s)>>>6),o.push(128|63&s)):(o.push(240|(1835008&s)>>>18),o.push(128|(258048&s)>>>12),o.push(128|(4032&s)>>>6),o.push(128|63&s));if(this.verify(e+o.length-1,"offset")){for(n=0,i=o.length;i>n;n++)this.buffer[e+n]=o[n];return!0}return!1},getUInt8:function(t){return this.verify(t,"offset")?this.buffer[t]:void 0},setUInt8:function(t,e){return this.verify(t,"uint8")&&this.verify(e,"offset")?(this.buffer[e]=t,!0):!1},getUInt16:function(t,e){var n=0;return this.verify(t,"offset")&&this.verify(t+1,"offset")?(e?(n=this.buffer[t]<<8,n|=this.buffer[t+1]):(n=this.buffer[t],n|=this.buffer[t+1]<<8),n):void 0},setUInt16:function(t,e,n){return this.verify(t,"uint16")&&this.verify(e,"offset")&&this.verify(e+1,"offset")?(n?(this.buffer[e]=(65280&t)>>>8,this.buffer[e+1]=255&t):(this.buffer[e+1]=(65280&t)>>>8,this.buffer[e]=255&t),!0):!1},getUInt32:function(t,e){var n=0;return this.verify(t,"offset")&&this.verify(t+3,"offset")?(e?(n=this.buffer[t+1]<<16,n|=this.buffer[t+2]<<8,n|=this.buffer[t+3],n+=this.buffer[t]<<24>>>0):(n=this.buffer[t+2]<<16,n|=this.buffer[t+1]<<8,n|=this.buffer[t],n+=this.buffer[t+3]<<24>>>0),n):void 0},setUInt32:function(t,e,n){return this.verify(t,"uint32")&&this.verify(e,"offset")&&this.verify(e+3,"offset")?(n?(this.buffer[e]=t>>>24&255,this.buffer[e+1]=t>>>16&255,this.buffer[e+2]=t>>>8&255,this.buffer[e+3]=255&t):(this.buffer[e+3]=t>>>24&255,this.buffer[e+2]=t>>>16&255,this.buffer[e+1]=t>>>8&255,this.buffer[e]=255&t),!0):!1},getInt8:function(t){return this.verify(t,"offset")?128&this.buffer[t]?-1*(255-this.buffer[t]+1):this.buffer[t]:void 0},setInt8:function(t,e){return this.verify(t,"int8")&&this.verify(e,"offset")?t>=0?this.setUInt8(t,e):this.setUInt8(255+t+1,e):!1},getInt16:function(t,e){var n=0;return this.verify(t,"offset")&&this.verify(t+1,"offset")?(n=this.getUInt16(t,e),32768&n&&(n=-1*(65535-n+1)),n):void 0},setInt16:function(t,e,n){return this.verify(t,"int16")&&this.verify(e,"offset")&&this.verify(e+1,"offset")?t>=0?this.setUInt16(t,e,n):this.setUInt16(65535+t+1,e,n):!1},getInt32:function(t,e){var n=0;return this.verify(t,"offset")&&this.verify(t+3,"offset")?(n=this.getUInt32(t,e),2147483648&n&&(n=-1*(4294967295-n+1)),n):void 0},setInt32:function(t,e,n){return this.verify(t,"int32")&&this.verify(e,"offset")&&this.verify(e+3,"offset")?t>=0?this.setUInt32(t,e,n):this.setUInt32(4294967295+t+1,e,n):!1},getFloat:function(t,e){return this.verify(t,"offset")&&this.verify(t+3,"offset")?l(this.buffer,t,e,23,4):void 0},setFloat:function(t,e,n){return this.verify(t,"float")&&this.verify(e,"offset")&&this.verify(e+3,"offset")?(u(this.buffer,t,e,n,23,4),!0):!1},getDouble:function(t,e){return this.verify(t,"offset")&&this.verify(t+7,"offset")?l(this.buffer,t,e,52,8):void 0},setDouble:function(t,e,n){return this.verify(t,"double")&&this.verify(e,"offset")&&this.verify(e+7,"offset")?(u(this.buffer,t,e,n,52,8),!0):!1}})}(Tian);