//=============================================================================
// Tian Observing and Control System Framework
//
// Copyright (c) 2011-2012, TIAN YANTAO
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//     * Redistributions of source code must retain the above copyright
//       notice, this list of conditions and the following disclaimer.
//     * Redistributions in binary form must reproduce the above copyright
//       notice, this list of conditions and the following disclaimer in the
//       documentation and/or other materials provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY TIAN YANTAO "AS IS" AND ANY EXPRESS OR IMPLIED
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
// EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
// INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
// (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
// LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
// ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
// THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//
// Contains portions of OpenLayers.js:
// http://svn.openlayers.org/trunk/openlayers/license.txt
//
// Contains portions of jQuery.js:
// http://jquery.org/license
//
// Contains portions of Require.js:
// https://github.com/jrburke/requirejs/blob/master/LICENSE
//
// Contains portions of binary.js:
// http://ats.oka.nu/titaniumcore/js/tools/binary.readme.txt
//
// Contains portions of Node.js:
// https://raw.github.com/joyent/node/v0.6.18/LICENSE
//-----------------------------------------------------------------------------
var Tian={};Tian.VERSION="1.0",Tian.BROWSER=function(){var e="",t=navigator.userAgent.toLowerCase();return t.indexOf("opera")!=-1?e="opera":t.indexOf("msie")!=-1?e="msie":t.indexOf("safari")!=-1?e="safari":t.indexOf("mozilla")!=-1&&(t.indexOf("firefox")!=-1?e="firefox":e="mozilla"),e}(),Tian.ISGECKO=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("webkit")==-1&&e.indexOf("gecko")!=-1}(),Tian.createUniqueID=function(){var e={};return function(t){return t=t||"txID_",t+="",typeof e[t]!="number"&&(e[t]=0),e[t]+=1,t+e[t]}}(),Tian.getScriptLocation=function(e,t){t=t||document;if(typeof t.getElementsByTagName!="function")return"";var n,r,i,s,o="";typeof e=="string"?n=new RegExp("(^|(.*?\\/))("+e+")(\\?|$)"):n=new RegExp("(^|(.*?\\/))(tian-"+Tian.VERSION+".min.js)(\\?|$)"),r=t.getElementsByTagName("script");for(var u=0,a=r.length;u<a;u++){i=r[u].getAttribute("src");if(i){var s=i.match(n);if(s){o=s[1];break}}}return o},Tian.getElement=function(){var e=[];for(var t=0,n=arguments.length;t<n;t++){var r=arguments[t];typeof r=="string"&&(r=document.getElementById(r));if(arguments.length==1)return r;e.push(r)}return e},Tian.getStyle=function(e,t){e=Tian.getElement(e);var n=null;if(e&&e.style){n=e.style[Tian.String.camelize(t)];if(!n)if(document.defaultView&&document.defaultView.getComputedStyle){var r=document.defaultView.getComputedStyle(e,null);n=r?r.getPropertyValue(t):null}else e.currentStyle&&(n=e.currentStyle[Tian.String.camelize(t)]);var i=["left","top","right","bottom"];window.opera&&Tian.Array.indexOf(i,t)!=-1&&Tian.getStyle(e,"position")=="static"&&(n="auto")}return n=="auto"?null:n},Tian.getViewportElement=function(){var e=arguments.callee.viewportElement;return e==undefined&&(e=Tian.BROWSER=="msie"&&document.compatMode!="CSS1Compat"?document.body:document.documentElement,arguments.callee.viewportElement=e),e},Tian.pagePosition=function(e){var t=[0,0],n=Tian.getViewportElement();if(!e||e==window||e==n)return t;var r=Tian.ISGECKO&&document.getBoxObjectFor&&Tian.getStyle(e,"position")=="absolute"&&(e.style.top==""||e.style.left==""),i=null,s;if(e.getBoundingClientRect){s=e.getBoundingClientRect();var o=window.pageYOffset||n.scrollTop,u=window.pageXOffset||n.scrollLeft;t[0]=s.left+u,t[1]=s.top+o}else if(document.getBoxObjectFor&&!r){s=document.getBoxObjectFor(e);var a=document.getBoxObjectFor(n);t[0]=s.screenX-a.screenX,t[1]=s.screenY-a.screenY}else{t[0]=e.offsetLeft,t[1]=e.offsetTop,i=e.offsetParent;if(i!=e)while(i)t[0]+=i.offsetLeft,t[1]+=i.offsetTop,i=i.offsetParent;var f=Tian.BROWSER;if(f=="opera"||f=="safari"&&Tian.getStyle(e,"position")=="absolute")t[1]-=document.body.offsetTop;i=e.offsetParent;while(i&&i!=document.body){t[0]-=i.scrollLeft;if(f!="opera"||i.tagName!="TR")t[1]-=i.scrollTop;i=i.offsetParent}}return t},Tian.extend=function(e,t){e=e||{};if(t){for(var n in t){var r=t[n];r!==undefined&&(e[n]=r)}var i=typeof window.Event=="function"&&t instanceof window.Event;!i&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},Tian.applyDefaults=function(e,t){e=e||{};var n=typeof window.Event=="function"&&t instanceof window.Event;for(var r in t)if(e[r]===undefined||!n&&t.hasOwnProperty&&t.hasOwnProperty(r)&&!e.hasOwnProperty(r))e[r]=t[r];return!n&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},function(e){"use strict";function t(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function n(e,t){return e<<t|e>>>32-t}function r(e,r,i,s,o,u){return t(n(t(t(r,e),t(s,u)),o),i)}function i(e,t,n,i,s,o,u){return r(t&n|~t&i,e,t,s,o,u)}function s(e,t,n,i,s,o,u){return r(t&i|n&~i,e,t,s,o,u)}function o(e,t,n,i,s,o,u){return r(t^n^i,e,t,s,o,u)}function u(e,t,n,i,s,o,u){return r(n^(t|~i),e,t,s,o,u)}function a(e,n){e[n>>5]|=128<<n%32,e[(n+64>>>9<<4)+14]=n;var r,a,f,l,c,h=1732584193,p=-271733879,d=-1732584194,v=271733878;for(r=0;r<e.length;r+=16)a=h,f=p,l=d,c=v,h=i(h,p,d,v,e[r],7,-680876936),v=i(v,h,p,d,e[r+1],12,-389564586),d=i(d,v,h,p,e[r+2],17,606105819),p=i(p,d,v,h,e[r+3],22,-1044525330),h=i(h,p,d,v,e[r+4],7,-176418897),v=i(v,h,p,d,e[r+5],12,1200080426),d=i(d,v,h,p,e[r+6],17,-1473231341),p=i(p,d,v,h,e[r+7],22,-45705983),h=i(h,p,d,v,e[r+8],7,1770035416),v=i(v,h,p,d,e[r+9],12,-1958414417),d=i(d,v,h,p,e[r+10],17,-42063),p=i(p,d,v,h,e[r+11],22,-1990404162),h=i(h,p,d,v,e[r+12],7,1804603682),v=i(v,h,p,d,e[r+13],12,-40341101),d=i(d,v,h,p,e[r+14],17,-1502002290),p=i(p,d,v,h,e[r+15],22,1236535329),h=s(h,p,d,v,e[r+1],5,-165796510),v=s(v,h,p,d,e[r+6],9,-1069501632),d=s(d,v,h,p,e[r+11],14,643717713),p=s(p,d,v,h,e[r],20,-373897302),h=s(h,p,d,v,e[r+5],5,-701558691),v=s(v,h,p,d,e[r+10],9,38016083),d=s(d,v,h,p,e[r+15],14,-660478335),p=s(p,d,v,h,e[r+4],20,-405537848),h=s(h,p,d,v,e[r+9],5,568446438),v=s(v,h,p,d,e[r+14],9,-1019803690),d=s(d,v,h,p,e[r+3],14,-187363961),p=s(p,d,v,h,e[r+8],20,1163531501),h=s(h,p,d,v,e[r+13],5,-1444681467),v=s(v,h,p,d,e[r+2],9,-51403784),d=s(d,v,h,p,e[r+7],14,1735328473),p=s(p,d,v,h,e[r+12],20,-1926607734),h=o(h,p,d,v,e[r+5],4,-378558),v=o(v,h,p,d,e[r+8],11,-2022574463),d=o(d,v,h,p,e[r+11],16,1839030562),p=o(p,d,v,h,e[r+14],23,-35309556),h=o(h,p,d,v,e[r+1],4,-1530992060),v=o(v,h,p,d,e[r+4],11,1272893353),d=o(d,v,h,p,e[r+7],16,-155497632),p=o(p,d,v,h,e[r+10],23,-1094730640),h=o(h,p,d,v,e[r+13],4,681279174),v=o(v,h,p,d,e[r],11,-358537222),d=o(d,v,h,p,e[r+3],16,-722521979),p=o(p,d,v,h,e[r+6],23,76029189),h=o(h,p,d,v,e[r+9],4,-640364487),v=o(v,h,p,d,e[r+12],11,-421815835),d=o(d,v,h,p,e[r+15],16,530742520),p=o(p,d,v,h,e[r+2],23,-995338651),h=u(h,p,d,v,e[r],6,-198630844),v=u(v,h,p,d,e[r+7],10,1126891415),d=u(d,v,h,p,e[r+14],15,-1416354905),p=u(p,d,v,h,e[r+5],21,-57434055),h=u(h,p,d,v,e[r+12],6,1700485571),v=u(v,h,p,d,e[r+3],10,-1894986606),d=u(d,v,h,p,e[r+10],15,-1051523),p=u(p,d,v,h,e[r+1],21,-2054922799),h=u(h,p,d,v,e[r+8],6,1873313359),v=u(v,h,p,d,e[r+15],10,-30611744),d=u(d,v,h,p,e[r+6],15,-1560198380),p=u(p,d,v,h,e[r+13],21,1309151649),h=u(h,p,d,v,e[r+4],6,-145523070),v=u(v,h,p,d,e[r+11],10,-1120210379),d=u(d,v,h,p,e[r+2],15,718787259),p=u(p,d,v,h,e[r+9],21,-343485551),h=t(h,a),p=t(p,f),d=t(d,l),v=t(v,c);return[h,p,d,v]}function f(e){var t,n="";for(t=0;t<e.length*32;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function l(e){var t,n=[];n[(e.length>>2)-1]=undefined;for(t=0;t<n.length;t+=1)n[t]=0;for(t=0;t<e.length*8;t+=8)n[t>>5]|=(e.charCodeAt(t/8)&255)<<t%32;return n}function c(e){return f(a(l(e),e.length*8))}function h(e,t){var n,r=l(e),i=[],s=[],o;i[15]=s[15]=undefined,r.length>16&&(r=a(r,e.length*8));for(n=0;n<16;n+=1)i[n]=r[n]^909522486,s[n]=r[n]^1549556828;return o=a(i.concat(l(t)),512+t.length*8),f(a(s.concat(o),640))}function p(e){var t="0123456789abcdef",n="",r,i;for(i=0;i<e.length;i+=1)r=e.charCodeAt(i),n+=t.charAt(r>>>4&15)+t.charAt(r&15);return n}function d(e){return unescape(encodeURIComponent(e))}function v(e){return c(d(e))}function m(e){return p(v(e))}function g(e,t){return h(d(e),d(t))}function y(e,t){return p(g(e,t))}function b(e,t,n){return t?n?g(t,e):y(t,e):n?v(e):m(e)}e.md5=b}(Tian),Tian.Array={isArray:function(e){return typeof Array.isArray=="function"?Array.isArray(e):Object.prototype.toString.call(e)==="[object Array]"},indexOf:function(e,t){if(typeof e.indexOf=="function")return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]==t)return n;return-1},removeItem:function(e,t){for(var n=e.length-1;n>=0;n--)e[n]==t&&e.splice(n,1);return e},filter:function(e,t,n){var r=[];if(Array.prototype.filter)r=e.filter(t,n);else{var i=e.length;if(typeof t!="function")throw new TypeError;for(var s=0;s<i;s++)if(s in e){var o=e[s];t.call(n,o,s,e)&&r.push(o)}}return r}},Tian.String={startsWith:function(e,t){return e.indexOf(t)==0},contains:function(e,t){return e.indexOf(t)!=-1},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){var t=e.split("-"),n=t[0];for(var r=1,i=t.length;r<i;r++){var s=t[r];n+=s.charAt(0).toUpperCase()+s.substring(1)}return n},format:function(e,t,n){t=t||window;var r=/\$\{([\w.]+?)\}/g,i=function(e,r){var i,s=r.split(/\.+/);for(var o=0;o<s.length;o++)o==0&&(i=t),i=i[s[o]];return typeof i=="function"&&(i=n?i.apply(null,n):i()),typeof i=="undefined"?"undefined":i};return e.replace(r,i)},isNumeric:function(e){var t=/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/;return t.test(e)},numericIf:function(e){return Tian.String.isNumeric(e)?parseFloat(e):e},isEmail:function(e){var t=/^([\w\d_\.-]+)@([\w\d_-]+\.)+\w{2,5}$/;return t.test(e)},isURL:function(e){var t=/^(https?:\/\/)?([\w\d_-]+\.)+\w{2,5}(\/[\w\d\.\?-_%=&]+)*$/;return t.test(e)},sprintf:function(){var e=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,t=arguments,n=0,r=t[n++],i=function(e,t,n,r){n||(n=" ");var i=e.length>=t?"":Array(1+t-e.length>>>0).join(n);return r?e+i:i+e},s=function(e,t,n,r,s,o){var u=r-e.length;return u>0&&(n||!s?e=i(e,r,o,n):e=e.slice(0,t.length)+i("",u,"0",!0)+e.slice(t.length)),e},o=function(e,t,n,r,o,u,a){var f=e>>>0;return n=n&&f&&{2:"0b",8:"0",16:"0x"}[t]||"",e=n+i(f.toString(t),u||0,"0",!1),s(e,n,r,o,a)},u=function(e,t,n,r,i,o){return r!=null&&(e=e.slice(0,r)),s(e,"",t,n,i,o)},a=function(e,r,a,f,l,c,h){var p,d,v,m,g;if(e=="%%")return"%";var y=!1,b="",w=!1,E=!1,S=" ",x=a.length;for(var T=0;a&&T<x;T++)switch(a.charAt(T)){case" ":b=" ";break;case"+":b="+";break;case"-":y=!0;break;case"'":S=a.charAt(T+1);break;case"0":w=!0;break;case"#":E=!0}f?f=="*"?f=+t[n++]:f.charAt(0)=="*"?f=+t[f.slice(1,-1)]:f=+f:f=0,f<0&&(f=-f,y=!0);if(!isFinite(f))throw new Error("sprintf: (minimum-)width must be finite");c?c=="*"?c=+t[n++]:c.charAt(0)=="*"?c=+t[c.slice(1,-1)]:c=+c:c="fFeE".indexOf(h)>-1?6:h=="d"?0:undefined,g=r?t[r.slice(0,-1)]:t[n++];switch(h){case"s":return u(String(g),y,f,c,w,S);case"c":return u(String.fromCharCode(+g),y,f,c,w);case"b":return o(g,2,E,y,f,c,w);case"o":return o(g,8,E,y,f,c,w);case"x":return o(g,16,E,y,f,c,w);case"X":return o(g,16,E,y,f,c,w).toUpperCase();case"u":return o(g,10,E,y,f,c,w);case"i":case"d":return p=+g||0,p=Math.round(p-p%1),d=p<0?"-":b,g=d+i(String(Math.abs(p)),c,"0",!1),s(g,d,y,f,w);case"e":case"E":case"f":case"F":case"g":case"G":return p=+g,d=p<0?"-":b,v=["toExponential","toFixed","toPrecision"]["efg".indexOf(h.toLowerCase())],m=["toString","toUpperCase"]["eEfFgG".indexOf(h)%2],g=d+Math.abs(p)[v](c),s(g,d,y,f,w)[m]();default:return e}};return r.replace(e,a)},sscanf:function(e,t){var n=[],r=0,i=/\S/,s=arguments,o=this,u,a=function(e){var r=t.slice(e).match(/%[cdeEufgosxX]/g);if(r){var i=r.length;while(i--)n.push(null)}return f()},f=function(){if(s.length===2)return n;for(var e=0;e<n.length;++e)o.window[s[e+2]]=n[e];return e},l=function(t,r,i){if(d){var s=e.slice(t),o=p?s.substr(0,p):s,a=r.exec(o),f=n[u!==undefined?u:n.length]=a?i?i.apply(null,a):a[0]:null;if(f===null)throw"No match in string";return t+a[0].length}return t};if(arguments.length<2)throw"Not enough arguments passed to sscanf";for(var c=0,h=0;c<t.length;c++){var p=0,d=!0;if(t.charAt(c)==="%"){if(t.charAt(c+1)==="%"){if(e.charAt(h)==="%"){++c,++h;continue}return a(c+2)}var v=new RegExp("^(?:(\\d+)\\$)?(\\*)?(\\d*)([hlL]?)","g"),m=v.exec(t.slice(c+1)),g=u;if(g&&m[1]===undefined)throw"All groups in sscanf() must be expressed as numeric if any have already been used";u=m[1]?parseInt(m[1],10)-1:undefined,d=!m[2],p=parseInt(m[3],10);var y=m[4];c+=v.lastIndex;if(y)switch(y){case"h":case"l":case"L":break;default:throw"Unexpected size specifier in sscanf()!"}try{switch(t.charAt(c+1)){case"F":break;case"g":break;case"G":break;case"b":break;case"i":h=l(h,/([+-])?(?:(?:0x([\da-fA-F]+))|(?:0([0-7]+))|(\d+))/,function(e,t,n,r,i){return n?parseInt(e,16):r?parseInt(e,8):parseInt(e,10)});break;case"n":n[u!==undefined?u:n.length-1]=h;break;case"c":h=l(h,new RegExp(".{1,"+(p||1)+"}"));break;case"D":case"d":h=l(h,/([+-])?(?:0*)(\d+)/,function(e,t,n){var r=parseInt((t||"")+n,10);return r});break;case"f":case"E":case"e":h=l(h,/([+-])?(?:0*)(\d*\.?\d*(?:[eE]?\d+)?)/,function(e,t,n){return n==="."?null:parseFloat((t||"")+n)});break;case"u":h=l(h,/([+-])?(?:0*)(\d+)/,function(e,t,n){var r=parseInt(n,10);return t==="-"?4294967296-r:r<4294967295?r:4294967295});break;case"o":h=l(h,/([+-])?(?:0([0-7]+))/,function(e,t,n){return parseInt(e,8)});break;case"s":h=l(h,/\S+/);break;case"X":case"x":h=l(h,/([+-])?(?:(?:0x)?([\da-fA-F]+))/,function(e,t,n){return parseInt(e,16)});break;case"":throw"Missing character after percent mark in sscanf() format argument";default:throw"Unrecognized character after percent mark in sscanf() format argument"}}catch(b){if(b==="No match in string")return a(c+2)}++c}else if(t.charAt(c)!==e.charAt(h)){i.lastIndex=0;if(i.test(e.charAt(h))||e.charAt(h)==="")return a(c+1);e=e.slice(0,h)+e.slice(h+1),c--}else h++}return f()}},Tian.inherit=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n;var r,i,s;for(r=2,i=arguments.length;r<i;r++)s=arguments[r],typeof s=="function"&&(s=s.prototype),Tian.extend(e.prototype,s)},Tian.Class=function(){var e=arguments.length,t=arguments[0],n=arguments[e-1],r=typeof n.initialize=="function"?n.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var i=[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),n);Tian.inherit.apply(null,i)}else r.prototype=n;return r},Tian.Function={bind:function(e,t){var n=Array.prototype.slice.apply(arguments,[2]);return function(){var r=n.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,r)}},bindAsEventListener:function(e,t){return function(n){return e.call(t,n||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},Tian.Window=Tian.Class({id:"",wm:null,w:0,h:0,x:0,y:0,userW:0,userH:0,userX:0,userY:0,movable:!1,alwaysOnTop:!1,resizing:!1,moving:!1,titleText:"",title:null,titleSpan:null,iconImageURL:"",state:"window",prvState:"",win:null,content:null,taskbarIcon:null,taskbarIconSpan:null,taskbarIconImage:null,components:null,currentUrl:"",closeConfirm:"",afterLoad:null,onunload:null,onselect:null,onresize:null,onmove:null,oniconize:null,ondeselect:null,onclose:null,onhttperror:null,initialize:function(e,t){this.id=e.id||Tian.createUniqueID(),this.wm=t,this.w=typeof e.width=="number"?e.width:t.opts.defaultWidth,this.h=typeof e.height=="number"?e.height:t.opts.defaultHeight,this.x=typeof e.x=="number"?e.x:t.opts.defaultX,this.y=typeof e.y=="number"?e.y:t.opts.defaultY,e.centered&&(this.x=(t.getContainerWidth()-this.w)/2,this.y=(t.getContainerHeight()-this.h)/2,this.x<0&&(this.x=0),this.y<0&&(this.y=0)),this.userW=this.w,this.userH=this.h,this.movable=typeof e.movable=="undefined"?t.opts.movable:e.movable,this.alwaysOnTop=e.alwaysOnTop||!1,this.titleText=e.title||"",this.iconImageURL=e.iconImageURL||"",this.afterLoad=e.afterLoad||t.opts.afterLoad,this.components={titlebar:null,window:null,content:null,maximizer:null,iconizer:null,close:null,icon:null,loading:null,iconImage:null}},destroy:function(){},attachEvents:function(){this.components.iconImage&&(Tian.Event.observe(this.components.iconImage,"mousedown",Tian.Function.bind(this.onIconMouseDown,this)),Tian.Event.observe(this.components.iconImage,"touchstart",Tian.Function.bind(this.onIconMouseDown,this)),Tian.Event.observe(this.components.iconImage,"mousemove",Tian.Function.bind(this.onIconMouseMove,this)),Tian.Event.observe(this.components.iconImage,"touchmove",Tian.Function.bind(this.onIconMouseMove,this)),Tian.Event.observe(this.components.iconImage,"mouseup",Tian.Function.bind(this.onIconMouseUp,this)),Tian.Event.observe(this.components.iconImage,"mouseout",Tian.Function.bind(this.onIconMouseUp,this)),Tian.Event.observe(this.components.iconImage,"touchend",Tian.Function.bind(this.onIconMouseUp,this))),this.titleSpan&&(Tian.Event.observe(this.titleSpan,"mousedown",Tian.Function.bind(this.onTitleMouseDown,this)),Tian.Event.observe(this.titleSpan,"touchstart",Tian.Function.bind(this.onTitleMouseDown,this)),Tian.Event.observe(this.titleSpan,"mousemove",Tian.Function.bind(this.onTitleMouseMove,this)),Tian.Event.observe(this.titleSpan,"touchmove",Tian.Function.bind(this.onTitleMouseMove,this)),Tian.Event.observe(this.titleSpan,"mouseup",Tian.Function.bind(this.onTitleMouseUp,this)),Tian.Event.observe(this.titleSpan,"mouseout",Tian.Function.bind(this.onTitleMouseUp,this)),Tian.Event.observe(this.titleSpan,"touchend",Tian.Function.bind(this.onTitleMouseUp,this))),this.components.close&&Tian.Event.observe(this.components.close,"click",Tian.Function.bind(this.onCloseClick,this)),this.components.maximizer&&Tian.Event.observe(this.components.maximizer,"click",Tian.Function.bind(this.onMaxClick,this)),this.components.iconizer&&Tian.Event.observe(this.components.iconizer,"click",Tian.Function.bind(this.onMinClick,this)),this.win&&Tian.Event.observe(this.win,"click",Tian.Function.bind(this.onWinClick,this))},detachEvents:function(){this.components.iconImage&&Tian.Event.stopObservingElement(this.components.iconImage),this.titleSpan&&Tian.Event.stopObservingElement(this.titleSpan),this.components.close&&Tian.Event.stopObservingElement(this.components.close),this.components.maximizer&&Tian.Event.stopObservingElement(this.components.maximizer),this.components.iconizer&&Tian.Event.stopObservingElement(this.components.iconizer),this.win&&Tian.Event.stopObservingElement(this.win)},onTitleMouseDown:function(e){Tian.Event.stop(e),this.select();if(!this.movable)return;this.moving=!0,e||(e=window.event);var t=this.wm.getEventXY(e,this.titleSpan);this.wm.mouse.click.x=t.x-this.x,this.wm.mouse.click.y=t.y-this.y},onTitleMouseMove:function(e){Tian.Event.stop(e);if(!this.moving)return;e||(e=window.event),this.state="window";var t=this.wm.getEventXY(e,this.titleSpan);this.wm.mouse.cur.x=t.x,this.wm.mouse.cur.y=t.y;var n=this.wm.mouse.cur.y-this.wm.mouse.click.y,r=this.wm.mouse.cur.x-this.wm.mouse.click.x;if(this.wm.opts.containerBoundaries>0){var i=-1*(this.getWidth()-this.wm.opts.containerBoundaries),s=this.getContainerWidth()-this.wm.opts.containerBoundaries,o=this.getContainerHeight()-this.wm.opts.containerBoundaries;r<i&&(r=i),r>s&&(r=s),n>o&&(n=o)}this.wm.opts.containerBoundaries>-1&&n<0&&(n=0),this.win.style.left=r+"px",this.win.style.top=n+"px",typeof this.onmove=="function"&&this.onmove(r,n)},onTitleMouseUp:function(e){Tian.Event.stop(e),this.moving=!1,this.state==="window"&&(this.w=parseInt(this.win.style.width,10),this.h=parseInt(this.win.style.height,10),this.x=parseInt(this.win.style.left,10),this.y=parseInt(this.win.style.top,10),this.userW=this.w,this.userH=this.h,this.userX=this.x,this.userY=this.y)},onIconMouseDown:function(e){Tian.Event.stop(e),this.select(),this.resizing=!0,e||(e=window.event);var t=this.wm.getEventXY(e,this.components.iconImage);this.wm.mouse.click.rx=t.x,this.wm.mouse.click.ry=t.y,this.wm.mouse.click.x=t.x-this.x,this.wm.mouse.click.y=t.y-this.y},onIconMouseMove:function(e){Tian.Event.stop(e);if(!this.resizing)return;this.state="window",e||(e=window.event);var t=this.wm.getEventXY(e,this.components.iconImage);this.wm.mouse.cur.x=t.x,this.wm.mouse.cur.y=t.y;var n=this.wm.mouse.cur.y-this.wm.mouse.click.y,r=this.wm.mouse.cur.x-this.wm.mouse.click.x;if(this.wm.opts.containerBoundaries>0){var i=-1*(this.getWidth()-this.wm.opts.containerBoundaries),s=this.getContainerWidth()-this.wm.opts.containerBoundaries,o=this.getContainerHeight()-this.wm.opts.containerBoundaries;r<i&&(r=i),r>s&&(r=s),n>o&&(n=o)}this.wm.opts.containerBoundaries>-1&&n<0&&(n=0),this.win.style.top=n+"px",this.win.style.left=r+"px";var u=this.h+(this.wm.mouse.click.ry-this.wm.mouse.cur.y),a=this.w+(this.wm.mouse.click.rx-this.wm.mouse.cur.x);a<90&&(a=90),u<50&&(u=50),this._setSize(a,u,!0,"resize")},onIconMouseUp:function(e){Tian.Event.stop(e),this.resizing=!1,this.state==="window"&&(this.w=parseInt(this.win.style.width,10),this.h=parseInt(this.win.style.height,10),this.x=parseInt(this.win.style.left,10),this.y=parseInt(this.win.style.top,10),this.userW=this.w,this.userH=this.h,this.userX=this.x,this.userY=this.y)},onCloseClick:function(e){Tian.Event.stop(e),this.select(),this.closeConfirm?window.confirm(this.closeConfirm)&&this.close():this.close()},onMaxClick:function(e){Tian.Event.stop(e),this.select(),this._maximize()},onMinClick:function(e){Tian.Event.stop(e),this.select(),this._iconify()},onWinClick:function(e){this.select()},getElement:function(e,t){t||(t=this.content);for(var n=0;n<t.childNodes.length;n++){if(t.childNodes[n].getAttribute&&t.childNodes[n].getAttribute("data-wid")==e)return t.childNodes[n];var r=this.getElement(e,t.childNodes[n]);if(r)return r}return null},setState:function(e){switch(e){case"maximized":if(this.state=="maximized")return;this._maximize();return;case"window":if(this.state=="maximized"){this._maximize();return}this.state="window",this.select();return;case"icon":this._iconify();return;case"hidden":this.hide();return}},setSize:function(e,t){this.state="window",this._setSize(e,t,!1,"resize"),this.userW=e,this.userH=t},autoSize:function(){this.win.style.height="0px",this.win.style.width="0px",this.content.style.height="0px",this.content.style.width="0px";var e=this.content.scrollWidth+30,t=this.content.scrollHeight+70;this.setSize(e,t),this.state="window"},setPosition:function(e,t){this._setPosition(e,t),typeof this.onmove=="function"&&this.onmove(e,t)},moveToCenter:function(){var e,t;e=(this.getContainerWidth()-this.w)/2,t=(this.getContainerHeight()-this.h)/2,t<0&&(t=0),this.setPosition(e,t)},close:function(){this.wm._destroyWindow(this)},select:function(){this.wm._selectWindow(this)},hide:function(){this.prvState=this.state,this.state="hidden",this.win.style.visibility="hidden",this.win.style.display="none"},attachTo:function(e){e=e||this.wm.opts.container,e.appendChild(this.win)},setContent:function(e,t){var n=null;t||(t=this.content,n=this.afterLoad),t.innerHTML=e.replace(/<script.*?>[\s\S]*?<\/.*?script>/gi,""),typeof n=="function"&&n(this)},loadUrl:function(e,t,n){this.showLoading();var r=!1;if(window.XMLHttpRequest&&!window.ActiveXObject)try{r=new XMLHttpRequest}catch(i){r=!1}else if(window.ActiveXObject)try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){r=!1}}if(!r)return window.alert("AJAX not supported by this browser"),typeof n=="function"&&n(this),!1;r.onreadystatechange=function(i){return function(){if(r.readyState==4){i.showLoading(!1);switch(r.status){case 200:i.currentUrl=e,i.setContent(r.responseText),typeof t=="function"&&t(i);break;default:typeof n=="function"&&n(i);if(typeof i.onhttperror=="function"){i.onhttperror(r,e);return}if(typeof i.wm.opts.httpErrorHandler=="function"){i.wm.opts.httpErrorHandler(r,e,i);return}window.alert("HTTP Error: "+r.status+"\n"+e)}}}}(this);if(!this.wm.opts.cacheXHR){var s=(new Date).getTime(),o=e.replace(/(\?|&)_=.*?(&|$)/,"$1_="+s+"$2");e=o+(o===e?(/\?/.test(e)?"&":"?")+"_="+s:"")}r.open("GET",e,!0),r.send("")},loadUrlX:function(e,t){this.showLoading(),this.content.innerHTML="";var n=document.createElement("iframe");n.className=this.wm.opts.classFrame,n.setAttribute("data-wid","theFrame");if(!this.wm.opts.cacheXHR){var r=new Date,i=r.getTime(),s=e.replace(/(\?|&)_=.*?(&|$)/,"$1_="+i+"$2");e=s+(s===e?(/\?/.test(e)?"&":"?")+"_="+i:"")}n.src=e,Tian.Event.observe(n,"load",function(n,r){return function(){n.currentUrl=e,n.showLoading(!1),typeof t=="function"&&t(n),Tian.Event.stopObservingElement(r)}}(this,n)),this.content.appendChild(n)},showLoading:function(e){typeof e=="undefined"||e?(this.loading.style.display="",this.loading.style.visibility="visible"):(this.loading.style.visibility="hidden",this.loading.style.display="none")},setTitle:function(e){e&&(this.titleText=e,this.titleSpan&&(this.titleSpan.innerHTML=e),this.taskbarIcon&&this.taskbarIcon.setAttribute("title",e),this.taskbarIconSpan&&(this.taskbarIconSpan.innerHTML=e))},setIconImage:function(e){e&&e!==this.iconImageURL&&(this.iconImageURL=e,this.components.iconImage&&(this.components.iconImage.src=e),this.taskbarIconImage&&(this.taskbarIconImage.src=e))},setCloseConfirm:function(e){this.closeConfirm=e},setMovable:function(e){this.movable=e},setAlwaysOnTop:function(e){e&&this.select(),this.alwaysOnTop=e},isMovable:function(){return this.movable},isAlwaysOnTop:function(){return this.alwaysOnTop},isSelected:function(){return this===this.getManager().getSelectedWindow()},getManager:function(){return this.wm},getComponent:function(e){return this.components[e]},getWidth:function(){return this.w},getHeight:function(){return this.h},getX:function(){return this.x},getY:function(){return this.y},getContentWidth:function(){return parseInt(this.content.style.width)},getContentHeight:function(){return parseInt(this.content.style.height)},getId:function(){return this.id},getTitle:function(){return this.titleText},getCurrentUrl:function(e){return this.wm.opts.cacheXHR||e?this.currentUrl:this.currentUrl.replace(/(\?|&)_=.*/,"")},getState:function(){return this.state},getContainer:function(){return this.win.parentNode},getContainerWidth:function(){var e=this.getContainer();return e===document.body?this.wm.getBodySize().width:e.clientWidth},getContainerHeight:function(){var e=this.getContainer();return e===document.body?this.wm.getBodySize().height:e.clientHeight},_setPosition:function(e,t){this.state="window",this.win.style.left=e+"px",this.win.style.top=t+"px",this.x=this.userX=e,this.y=this.userY=t},_maximize:function(){if(this.state!="maximized"){var e=this.win.offsetWidth-parseInt(this.win.style.width),t=this.win.offsetHeight-parseInt(this.win.style.height);this.win.style.top="0px",this.win.style.left="0px",this.x=this.y=1,this.state="maximized";var n=this.getContainerWidth()-e,r=this.getContainerHeight()-t;this._setSize(n,r,!1,"maximize")}else this.state="window",this._setSize(this.userW,this.userH,!1,"restore"),this._setPosition(this.userX,this.userY)},_setSize:function(e,t,n,r){this.win.style.height=t+"px",this.win.style.width=e+"px";var i=e-(this.content.offsetWidth-parseInt(this.content.style.width)),s=t-(this.content.offsetHeight-parseInt(this.content.style.height))-this.content.offsetTop;this.content.style.height=s+"px",this.content.style.width=i+"px",n||(this.w=e,this.h=t),r&&typeof this.onresize=="function"&&this.onresize(e,t,r)},_iconify:function(){if(!this.wm.opts.taskbar||this.state=="icon")return;this.taskbarIcon||this._createTaskbarIcon(),this.taskbarIcon.className=this.wm.opts.classIcon,this.wm.selectedWindow==this&&(this.wm.selectedWindow=null),this.hide(),this.state="icon";var e=this.wm._getFirstVisibleWindow();e&&e.select(),typeof this.oniconize=="function"&&this.oniconize()},_createTaskbarIcon:function(){if(!this.wm.opts.taskbar)return;this.taskbarIcon=document.createElement("div"),this.taskbarIcon.className=this.wm.opts.classIcon,this.taskbarIcon.setAttribute("title",this.titleText),this.taskbarIcon.style.width=this.wm.opts.iconWidth+"px",this.taskbarIconImage=document.createElement("img"),this.taskbarIconImage.src=this.iconImageURL,this.taskbarIconImage.setAttribute("title",this.titleText),this.taskbarIcon.appendChild(this.taskbarIconImage),this.taskbarIconSpan=document.createElement("span"),this.taskbarIconSpan.innerHTML=this.titleText,this.taskbarIcon.appendChild(this.taskbarIconSpan),this.wm.opts.taskbar.appendChild(this.taskbarIcon),this.components.icon=this.taskbarIcon,this.wm.opts.resizeIcons&&this.wm._resizeIcons(),Tian.Event.observe(this.taskbarIcon,"click",Tian.Function.bind(this.onTaskbarIconClick,this)),Tian.Event.observe(this.taskbarIcon,"dblclick",Tian.Function.bind(this.onTaskbarIconDoubleClick,this))},_removeTaskbarIcon:function(){Tian.Event.stopObservingElement(this.taskbarIcon),this.taskbarIcon.parentNode.removeChild(this.taskbarIcon),this.taskbarIcon=null,this.wm.opts.resizeIcons&&this.wm._resizeIcons()},onTaskbarIconClick:function(e){Tian.Event.stop(e),this.isSelected()?this._iconify():this.select()},onTaskbarIconDoubleClick:function(e){Tian.Event.stop(e),this.moveToCenter()},_unload:function(){return typeof this.onunload=="function"&&!this.onunload()?!1:(this.detachEvents(),this.onunload=null,this.onselect=null,this.onresize=null,this.onmove=null,this.oniconize=null,this.ondeselect=null,this.onhttperror=null,!0)},CLASS_NAME:"Tian.Window"}),Tian.Lang={code:null,defaultCode:"en",getCode:function(){return Tian.Lang.code||Tian.Lang.setCode(),Tian.Lang.code},setCode:function(e){var t;e||(e=Tian.BROWSER=="msie"?navigator.userLanguage:navigator.language);var n=e.split("-");n[0]=n[0].toLowerCase(),t=n[0],n[1]&&(t=n[0]+"-"+n[1].toUpperCase()),t||(t=Tian.Lang.defaultCode),Tian.Lang.code=t},translate:function(e){var t=Tian.Lang[Tian.Lang.getCode()],n=t&&t[e];return n||(n=e),n},add:function(e,t,n){return typeof Tian.Lang[e]!="object"&&(Tian.Lang[e]={}),typeof Tian.Lang[e][t]=="string"?!1:(Tian.Lang[e][t]=n,!0)}},Tian.i18n=Tian.Lang.translate,Tian.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&e.touches.length==1},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&e.which==1||e.button&&e.button==1},isRightClick:function(e){return e.which&&e.which==3||e.button&&e.button==2},getTouchClientXY:function(e){var t=window.pageXOffset||0,n=window.pageYOffset||0,r=e.clientX,i=e.clientY;if(e.pageY===0&&Math.floor(i)>Math.floor(e.pageY)||e.pageX===0&&Math.floor(r)>Math.floor(e.pageX))r-=t,i-=n;else if(i<e.pageY-n||r<e.pageX-t)r=e.pageX-t,i=e.pageY-n;return{clientX:r,clientY:i}},stop:function(e,t){t||(e.preventDefault?e.preventDefault():e.returnValue=!1),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},findElement:function(e,t){var n=Tian.Event.element(e);while(n.parentNode&&(!n.tagName||n.tagName.toUpperCase()!=t.toUpperCase()))n=n.parentNode;return n},observe:function(e,t,n,r){var i=Tian.getElement(e);r=r||!1,t=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.attachEvent)&&(t="keydown"),this.observers||(this.observers={});if(!i._eventCacheID){var s="eventCacheID_";i.id&&(s=i.id+"_"+s),i._eventCacheID=Tian.createUniqueID(s)}var o=i._eventCacheID;this.observers[o]||(this.observers[o]=[]),this.observers[o].push({element:i,name:t,observer:n,useCapture:r}),i.addEventListener?i.addEventListener(t,n,r):i.attachEvent&&i.attachEvent("on"+t,n)},stopObservingElement:function(e){var t=Tian.getElement(e),n=t._eventCacheID;this._removeElementObservers(Tian.Event.observers[n])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var n=e[t];Tian.Event.stopObserving.apply(this,[n.element,n.name,n.observer,n.useCapture])}},stopObserving:function(e,t,n,r){r=r||!1;var i=Tian.getElement(e),s=i._eventCacheID;t=="keypress"&&
(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.detachEvent)&&(t="keydown");var o=!1,u=Tian.Event.observers[s];if(u){var a=0;while(!o&&a<u.length){var f=u[a];if(f.name==t&&f.observer==n&&f.useCapture==r){u.splice(a,1),u.length==0&&delete Tian.Event.observers[s],o=!0;break}a++}}return o&&(i.removeEventListener?i.removeEventListener(t,n,r):i&&i.detachEvent&&i.detachEvent("on"+t,n)),o},unloadCache:function(){if(Tian.Event&&Tian.Event.observers){for(var e in Tian.Event.observers){var t=Tian.Event.observers[e];Tian.Event._removeElementObservers.apply(this,[t])}Tian.Event.observers=!1}}},Tian.Event.observe(window,"unload",Tian.Event.unloadCache,!1),Tian.Events=Tian.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,n,r){Tian.extend(this,r),this.object=e,this.fallThrough=n,this.listeners={},this.extensions={},this.extensionCount={},t!=null&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)typeof this.extensions[e]!="boolean"&&this.extensions[e].destroy();this.extensions=null,this.element&&(Tian.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&Tian.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},attachToElement:function(e){this.element?Tian.Event.stopObservingElement(this.element):(this.eventHandler=Tian.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=Tian.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t=0,n=this.BROWSER_EVENTS.length;t<n;t++)Tian.Event.observe(e,this.BROWSER_EVENTS[t],this.eventHandler);Tian.Event.observe(e,"dragstart",Tian.Event.stop)},on:function(e){for(var t in e)t!="scope"&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,n,r){e in Tian.Events&&!this.extensions[e]&&(this.extensions[e]=new Tian.Events[e](this));if(n!=null){t==null&&(t=this.object);var i=this.listeners[e];i||(i=[],this.listeners[e]=i,this.extensionCount[e]=0);var s={obj:t,func:n};r?(i.splice(this.extensionCount[e],0,s),typeof r=="object"&&r.extension&&this.extensionCount[e]++):i.push(s)}},registerPriority:function(e,t,n){this.register(e,t,n,!0)},un:function(e){for(var t in e)t!="scope"&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,n){t==null&&(t=this.object);var r=this.listeners[e];if(r!=null)for(var i=0,s=r.length;i<s;i++)if(r[i].obj==t&&r[i].func==n){r.splice(i,1);break}},remove:function(e){this.listeners[e]!=null&&(this.listeners[e]=[])},emit:function(e,t){var n=this.listeners[e];if(!n||n.length==0)return undefined;t==null&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e),n=n.slice();var r;for(var i=0,s=n.length;i<s;i++){var o=n[i];r=o.func.apply(o.obj,[t]);if(r!=undefined&&r==0)break}return this.fallThrough||Tian.Event.stop(t,!0),r},handleBrowserEvent:function(e){var t=e.type,n=this.listeners[t];if(!n||n.length==0)return;var r=e.touches;if(r&&r[0]){var i=0,s=0,o=r.length,u;for(var a=0;a<o;++a)u=Tian.Event.getTouchClientXY(r[a]),i+=u.clientX,s+=u.clientY;e.clientX=i/o,e.clientY=s/o}this.includeXY&&(e.xy=this.getMousePosition(e)),this.emit(t,e)},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(e){this.includeXY?this.element.hasScrollEvent||(Tian.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls){var t=Tian.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=Tian.pagePosition(this.element));var n={x:e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],y:e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1]};return n},CLASS_NAME:"Tian.Events"}),Tian.Winager=Tian.Class({windows:null,winSelected:null,winDragging:null,mouse:null,opts:null,initialize:function(e){this.windows=[],this.mouse={cur:{x:0,y:0},click:{x:0,y:0}},this.opts={classWindow:"txWindow",classActiveWindow:"txWindowActive",classContent:Tian.BROWSER==="safari"?"txWinContentSafari":"txWinContent",classFrame:"txWinFrame",classTitle:"txWinTitle txWidgetNoSelect",classIcon:"txWinTaskBarIcon",classActiveIcon:"txWinTaskBarIconActive",baseZIndex:5e3,taskbar:null,container:document.body,iconImageURL:"",defaultX:32,defaultY:32,defaultWidth:500,defaultHeight:300,shiftOffset:32,movable:!0,httpErrorHandler:null,containerBoundaries:64,iconWidth:36,resizeIcons:!0,afterLoad:null,cacheXHR:!1},Tian.extend(this.opts,e),Tian.Event.observe(window,"resize",Tian.Function.bind(this.checkResize,this))},destroy:function(){Tian.Event.stopObserving(window,"resize",Tian.Function.bind(this.checkResize,this));var e=this.getAllWindows();for(var t=0;t<e.length;t++)e[t].close(),e[t]=undefined},checkResize:function(){for(var e=0;e<this.windows.length;e++){var t=this.windows[e];if(t.state!="maximized")continue;var n=t.win.offsetWidth-parseInt(t.win.style.width),r=t.win.offsetHeight-parseInt(t.win.style.height),i=t.getContainerWidth()-n,s=t.getContainerHeight()-r;t._setSize(i,s,!1,"resize")}this._resizeIcons()},_resizeIcons:function(){var e=function(e,t){var n=parseInt(Tian.getStyle(e,t));return isNaN(n)?0:n},t,n=[];for(t=0;t<this.windows.length;t++){var r=this.windows[t];r.taskbarIcon&&r.taskbarIcon.parentNode==this.opts.taskbar&&n.push(r.taskbarIcon)}if(n.length<1)return;var i=this.opts.taskbar.clientWidth-e(this.opts.taskbar,"padding-left")-e(this.opts.taskbar,"padding-right")-1,s=parseInt(i/n.length);for(t=0;t<n.length;t++){var o=n[t],u=o.offsetWidth+e(o,"margin-left")+e(o,"margin-right")-e(o,"width");this.opts.iconWidth+u>s?o.style.width=s-u-1+"px":o.style.width=this.opts.iconWidth+"px"}},createWindow:function(e){e=e||{};if(e.id&&this.getWindow(e.id)!=null)return null;var t=e.container||this.opts.container,n=e.state||this.opts.defaultState,r=new Tian.Window(e,this);r.win=document.createElement("div"),r.content=document.createElement("div");if(this.opts.shiftOffset>0){var i;do for(i=0;i<this.windows.length;i++){var s=this.windows[i];if((s.x===r.x||s.userX===r.x)&&(s.y===r.y||s.userY===r.y)){r.x+=this.opts.shiftOffset,r.y+=this.opts.shiftOffset,r.x+r.w>this.getContainerWidth()&&(r.x=this.opts.defaultX),r.y+r.h>this.getContainerHeight()&&(r.y=this.opts.defaultY);break}}while(i!=this.windows.length)}return r.userX=r.x,r.userY=r.y,r.win.className=this.opts.classWindow,r.win.style.cssText="z-index:"+this.opts.baseZIndex+";position:absolute;top:"+r.y+"px;left:"+r.x+"px;",r.content.className=this.opts.classContent,r.content.style.cssText="position:relative;margin:0;width:0px;height:0px",r.title=document.createElement("div"),r.title.className=this.opts.classTitle,r.components.iconImage=document.createElement("img"),r.components.iconImage.className="txWinIconImage",r.components.iconImage.src=r.iconImageURL,r.title.appendChild(r.components.iconImage),r.titleSpan=document.createElement("div"),r.titleSpan.className="txWinTitleText",r.titleSpan.innerHTML=r.titleText,r.title.appendChild(r.titleSpan),r.components.close=document.createElement("div"),r.components.close.className="txWinCloseBox",r.title.appendChild(r.components.close),r.components.maximizer=document.createElement("div"),r.components.maximizer.className="txWinMaxBox",r.title.appendChild(r.components.maximizer),this.opts.taskbar&&(r.components.iconizer=document.createElement("div"),r.components.iconizer.className="txWinMinBox",r.title.appendChild(r.components.iconizer)),r.win.appendChild(r.title),r.components.titlebar=r.title,r.win.appendChild(r.content),r.components.content=r.content,r.loading=document.createElement("div"),r.loading.className="txWinLoading",r.title?r.title.appendChild(r.loading):r.win.appendChild(r.loading),r.components.loading=r.loading,t.appendChild(r.win),r.components.window=r.win,r._setSize(r.w,r.h,!1,""),this.windows.push(r),this.opts.taskbar&&r._createTaskbarIcon(),this._selectWindow(r,!0),n!="window"&&r.setState(n),r.attachEvents(),r.closeConfirm=e.closeConfirm||"",r},getWindow:function(e){var t;for(var t=0;t<this.windows.length;t++){var n=this.windows[t];if(n.id==e)return n}return null},getSelectedWindow:function(){return this.selectedWindow},getAllWindows:function(){var e=[];for(var t=this.windows.length-1;t>=0;t--)e.push(this.windows[t]);return e},getContainerHeight:function(){return this.opts.container===document.body?this.getBodySize().height:this.opts.container.clientHeight},getContainerWidth:function(){return this.opts.container==document.body?this.getBodySize().width:this.opts.container.clientWidth},_getFirstVisibleWindow:function(){for(var e=this.windows.length-1;e>=0;e--){var t=this.windows[e];if(t.win.style.visibility!="hidden")return t}return null},_selectWindow:function(e){if(e==this.selectedWindow)return;this.selectedWindow&&this.selectedWindow.ondeselect&&this.selectedWindow.ondeselect();if(!e.alwaysOnTop)for(var t=0;t<this.windows.length;t++)if(this.windows[t]==e){var n=this.windows.splice(t,1);for(var r=this.windows.length-1;r>=0;r--)if(!this.windows[r].alwaysOnTop)break;this.windows.splice(r+1,0,n[0]);break}for(var t=0;t<this.windows.length;t++){var i=this.windows[t];i.win.style.zIndex=this.opts.baseZIndex+t,i.win.className=this.opts.classWindow,i.taskbarIcon&&(i.taskbarIcon.className=this.opts.classIcon),i.components.close&&(i.components.close.className="txWinCloseBox")}e.win.style.display="",e.win.style.visibility="visible",e.win.className=this.opts.classActiveWindow,e.taskbarIcon&&(e.taskbarIcon.className=this.opts.classActiveIcon),e.components.close&&(e.components.close.className="txWinCloseBoxActive"),this.selectedWindow=e;if(e.state=="icon"||e.state=="hidden")e.state=e.prvState,e.prvState=null;e.onselect&&e.onselect()},_destroyWindow:function(e){for(var t=0;t<this.windows.length;t++){var n=this.windows[t];if(n==e){if(!n._unload(!1))return!1;n.getContainer().removeChild(n.win),n.taskbarIcon!=null&&n._removeTaskbarIcon();var r=this.windows.splice(t,1)[0];for(var i=0;i<this.windows.length;i++)this.windows[i].win.style.zIndex=this.opts.baseZIndex+i;typeof r.onclose=="function"&&(r.onclose(),r.onclose=null),r=null;var s=this._getFirstVisibleWindow();s&&s.select();return}}return null},handleBrowserEvent:function(e){var t=e.touches;if(t&&t[0]){var n=0,r=0,i=t.length,s;for(var o=0;o<i;++o)s=Tian.Event.getTouchClientXY(t[o]),n+=s.clientX,r+=s.clientY;e.clientX=n/i,e.clientY=r/i}return e},getEventXY:function(e,t){e=this.handleBrowserEvent(e);if(!t.scrolls){var n=Tian.getViewportElement();t.scrolls=[n.scrollLeft,n.scrollTop]}t.lefttop||(t.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),t.offsets||(t.offsets=Tian.pagePosition(t));var r={x:e.clientX+t.scrolls[0]-t.offsets[0]-t.lefttop[0],y:e.clientY+t.scrolls[1]-t.offsets[1]-t.lefttop[1]};return r},getBodySize:function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return{width:e,height:t}},CLASS_NAME:"Tian.Winager"}),Tian.Widget=Tian.Class({div:null,title:null,baseZIndex:1e3,os:null,initialize:function(){},draw:function(){return this.div=document.createElement("div"),this.div.id=Tian.createUniqueID("txWidgetID_"),this.div.style.zIndex=this.baseZIndex+parseInt(this.div.id.slice(11),10),this.title&&(this.div.title=this.title),this.div},destroy:function(){var e=this.div.parentNode;e&&e.removeChild&&e.removeChild(this.div),this.div=null,this.os=null},setOS:function(e){this.os||(this.os=e)},getOS:function(){return this.os},CLASS_NAME:"Tian.Widget"}),function($){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}$.JSON||($.JSON={}),typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof $.JSON.stringify!="function"&&($.JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("Tian.JSON.stringify")}),typeof $.JSON.parse!="function"&&($.JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("Tian.JSON.parse")})}(Tian),function(e){function u(){var e=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),e=!0,window.localStorage.removeItem("_tmptest")}catch(t){}if(e)try{window.localStorage&&(n=window.localStorage,s="localStorage")}catch(i){}else if("globalStorage"in window)try{window.globalStorage&&(n=window.globalStorage[window.location.hostname],s="globalStorage")}catch(o){}else{r=document.createElement("link");if(!r.addBehavior){r=null;return}r.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(r),r.load("jStorage");var u="{}";try{u=r.getAttribute("jStorage")}catch(f){}n.jStorage=u,s="userDataBehavior"}a(),c()}function a(){if(n.jStorage)try{t=e.JSON.parse(String(n.jStorage))}catch(r){n.jStorage="{}"}else n.jStorage="{}";i=n.jStorage?String(n.jStorage).length:0}function f(){try{n.jStorage=e.JSON.stringify(t),r&&(r.setAttribute("jStorage",n.jStorage),r.save("jStorage")),i=n.jStorage?String(n.jStorage).length:0}catch(s){}}function l(e){if(!e||typeof e!="string"&&typeof e!="number")throw new TypeError("Key name must be string or numeric");if(e=="__jstorage_meta")throw new TypeError("Reserved key name");return!0}function c(){var e,n,r,i=Infinity,s=!1;clearTimeout(o);if(!t.__jstorage_meta||typeof t.__jstorage_meta.TTL!="object")return;e=+(new Date),r=t.__jstorage_meta.TTL;for(n in r)r.hasOwnProperty(n)&&(r[n]<=e?(delete r[n],delete t[n],s=!0):r[n]<i&&(i=r[n]));i!=Infinity&&(o=setTimeout(c,i-e)),s&&f()}var t={},n={jStorage:"{}"},r=null,i=0,s=!1,o;e.DB={VERSION:"2012-11-29",set:function(n,r,i){return l(n),i=i||{},typeof r=="function"?r=null:r&&typeof r=="object"&&(r=e.JSON.parse(e.JSON.stringify(r))),t[n]=r,isNaN(i.TTL)?f():this.setTTL(n,i.TTL),r},get:function(e,n){return l(e),e in t?t[e]:typeof n=="undefined"?null:n},deleteKey:function(e){return l(e),e in t?(delete t[e],t.__jstorage_meta&&typeof t.__jstorage_meta.TTL=="object"&&e in t.__jstorage_meta.TTL&&delete t.__jstorage_meta.TTL[e],f(),!0):!1},setTTL:function(e,n){var r=+(new Date);return l(e),n=Number(n)||0,e in t?(t.__jstorage_meta||(t.__jstorage_meta={}),t.__jstorage_meta.TTL||(t.__jstorage_meta.TTL={}),n>0?t.__jstorage_meta.TTL[e]=r+n:delete t.__jstorage_meta.TTL[e],f(),c(),!0):!1},flush:function(){return t={},f(),!0},storageObj:function(){function e(){}return e.prototype=t,new e},index:function(){var e=[],n;for(n in t)t.hasOwnProperty(n)&&n!="__jstorage_meta"&&e.push(n);return e},storageSize:function(){return i},currentBackend:function(){return s},storageAvailable:function(){return!!s},reInit:function(){var e,t;if(r&&r.addBehavior){e=document.createElement("link"),r.parentNode.replaceChild(e,r),r=e,r.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(r),r.load("jStorage"),t="{}";try{t=r.getAttribute("jStorage")}catch(i){}n.jStorage=t,s="userDataBehavior"}a()}},u()}(Tian),Tian.App=Tian.Class({os:null,div:null,childTitle:null,childIcon:null,title:"",icon:"",page:"",window:null,width:450,height:250,xdomain:!1,theApp:null,initialize:function(e){Tian.extend(this,e);if(this.title)if(typeof this.title=="object"){var t=Tian.Lang.getCode();if(typeof this.title[t]=="string")this.title=this.title[t];else for(var n in this.title){this.title=this.title[n]+"";break}}else this.title+="";else this.title="Unknwon App"},destroy:function(){this.window&&(this.window.close(),this.window=null),Tian.Event.stopObservingElement(this.div),this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.div=null,this.childIcon=null,this.childTitle=null,this.os=null},draw:function(){return!this.icon&&this.os&&(this.icon=this.os.getImagePath()+"default_app_icon.png"),this.div==null&&(this.div=document.createElement("div")),this.div.className="txApp",this.icon&&(this.childIcon=document.createElement("img"),this.childIcon.src=this.icon,this.div.appendChild(this.childIcon)),this.title&&(this.childTitle=document.createElement("p"),this.childTitle.innerHTML=this.title,this.div.appendChild(this.childTitle)),Tian.Event.observe(this.div,"click",Tian.Function.bindAsEventListener(this.onOpen,this)),this.div},setOS:function(e){this.os||(this.os=e)},getOS:function(){return this.os},onOpen:function(e){e&&Tian.Event.stop(e);if(this.window){this.window.select();return}if(!this.os)return;var t=this.os.getWindowManager(),n=null,r=null,i=null,s=null;n=Tian.DB.get(Tian.md5(this.title+"_ww")),r=Tian.DB.get(Tian.md5(this.title+"_wh")),i=Tian.DB.get(Tian.md5(this.title+"_wx")),s=Tian.DB.get(Tian.md5(this.title+"_wy")),this.window=t.createWindow({title:this.title,state:"window",width:n?n:this.width,height:r?r:this.height,x:i?i:null,y:s?s:null,iconImageURL:this.icon}),this.window.onclose=Tian.Function.bind(this.onWinClose,this),this.window.onmove=Tian.Function.bind(this.onWinMove,this),this.window.onresize=Tian.Function.bind(this.onWinResize,this),this.page&&this.window.loadUrlX(this.page,Tian.Function.bind(this.onWinLoad,this))},setTitle:function(e){e&&e!==this.title&&(this.title=e,this.childTitle.innerHTML=e,this.window&&this.window.setTitle(e))},getTitle:function(){return this.title},setIcon:function(e){e&&e!==this.icon&&(this.icon=e,this.childIcon.src=e,this.window&&this.window.setIconImage(e))},onWinLoad:function(e){if(!e)return;var t=e.getElement("theFrame");!this.xdomain&&t&&t.contentWindow&&typeof t.contentWindow.tianMain=="function"&&(this.theApp=t.contentWindow.tianMain.call(t.contentWindow,{app:this,win:e}))},onWinClose:function(){this.window=null,this.theApp=null},onWinMove:function(e,t){Tian.DB.set(Tian.md5(this.title+"_wx"),e),Tian.DB.set(Tian.md5(this.title+"_wy"),t)},onWinResize:function(e,t,n){switch(n){case"resize":Tian.DB.set(Tian.md5(this.title+"_ww"),e),Tian.DB.set(Tian.md5(this.title+"_wh"),t);break;case"maximize":break;case"restore":}},CLASS_NAME:"Tian.App"}),Tian.Widget.MainPanel=Tian.Class(Tian.Widget,{mainDiv:null,window:null,width:540,height:300,apps:null,initialize:function(){Tian.Widget.prototype.initialize.apply(this,arguments),this.apps=[]},draw:function(){return Tian.Widget.prototype.draw.apply(this,arguments),this.div.className="txWidgetMainPanel txWidgetNoSelect",this.mainDiv=document.createElement("div"),this.mainDiv.className="txWidgetMainPanelContent",Tian.Event.observe(this.div,"click",Tian.Function.bindAsEventListener(this.onClick,this)),this.div},destroy:function(){if(this.apps){for(var e=this.apps.length-1;e>=0;e--)this.delApp(this.apps[e]),this.apps[e].destroy();this.apps=null}this.window&&(this.window.close(),this.window=null),this.mainDiv&&(this.mainDiv=null),Tian.Event.stopObservingElement(this.div),Tian.Widget.prototype.destroy.apply(this,arguments)},onClick:function(e){e&&Tian.Event.stop(e);if(this.window){this.window.select();return}if(!this.os)return;var t=this.os.getWindowManager(),n=null,r=null,i=null,s=null;n=Tian.DB.get(Tian.md5(this.title+"_ww")),r=Tian.DB.get(Tian.md5(this.title+"_wh")),i=Tian.DB.get(Tian.md5(this.title+"_wx")),s=Tian.DB.get(Tian.md5(this.title+"_wy")),this.window=t.createWindow({title:this.title,centered:!0,state:"window",width:n?n:this.width,height:r?r:this.height,x:i?i:null,y:s?s:null,iconImageURL:this.getOS().getImagePath()+"main_icon.png"}),this.window.getComponent("content").innerHTML="",this.window.getComponent("content").appendChild(this.mainDiv),this.window.getComponent("content").style.overflow="auto",this.window.onclose=Tian.Function.bind(this.onWinClose,this),this.window.onmove=Tian.Function.bind(this.onWinMove,this),this.window.onresize=Tian.Function.bind(this.onWinResize,this)},onWinClose:function(e){this.window=null},onWinMove:function(e,t){Tian.DB.set(Tian.md5(this.title+"_wx"),e),Tian.DB.set(Tian.md5(this.title+"_wy"),t)},onWinResize:function(e,t,n){switch(n){case"resize":Tian.DB.set(Tian.md5(this.title+"_ww"),e),Tian.DB.set(Tian.md5(this.title+"_wh"),t);break;case"maximize":break;case"restore":}},addApp:function(e){e instanceof Tian.App&&(e.setOS(this.os),this.mainDiv.appendChild(e.draw()),this.apps.push(e))},delApp:function(e){e instanceof Tian.App&&(this.mainDiv.removeChild(e.div),Tian.Array.removeItem(this.apps,e),e.window&&(e.window.close(),e.window=null))},clearApps:function(){if(this.apps){for(var e=this.apps.length-1;e>=0;e--)this.delApp(this.apps[e]),this.apps[e].destroy();this.apps=[]}},getAllApps:function(){return this.apps},CLASS_NAME:"Tian.Widget.MainPanel"}),Tian.Widget.TitleBar=Tian.Class(Tian.Widget,{spanTitle:null,spanNotify:null,notifications:null,initialize:function(){Tian.Widget.prototype.initialize.apply(this,arguments),this.notifications=[]},draw:function(){return Tian.Widget.prototype.draw.apply(this,arguments),this.div.className="txWidgetTitleBar txWidgetNoSelect",this.spanTitle=document.createElement("span"),this.spanTitle.className="txWidgetTitleBarTitle",this.div.appendChild(this.spanTitle),this.spanNotify=document.createElement("span"),this.spanNotify.className="txWidgetTitleBarNotification",this.div.appendChild(this.spanNotify),this.div},destroy:function(){this.os&&this.os.events.unregister("notify",this,this.onNotify),this.notifications=null,Tian.Widget.prototype.destroy.apply(this,arguments)},setOS:function(e){Tian.Widget.prototype.setOS.apply(this,arguments),this.os&&(this.spanTitle.innerHTML=this.os.title,this.os.events.register("notify",this,this.onNotify))},onNotify:function(e){e&&e.data&&(this.spanNotify.innerHTML=e.data.notification,this.notifications.push(e.data),this.notifications.length>999&&this.notifications.shift())},clearNotifications:function(){this.spanNotify.innerHTML="",this.notifications=[]},CLASS_NAME:"Tian.Widget.TitleBar"}),Tian.Widget.Taskbar=Tian.Class(Tian.Widget,{draw:function(){return Tian.Widget.prototype.draw.apply(this,arguments),this.div&&(this.div.className="txWidgetTaskbar txWidgetNoSelect"),this.div},CLASS_NAME:"Tian.Widget.Taskbar"}),Tian.OS=Tian.Class({title:"",div:null,mainPanel:null,titleBar:null,taskbar:null,widgets:null,wm:null,theme:"default",themeHost:"",imagePath:"",events:null,initialize:function(e,t){this.title=e?e:"TianOX",typeof t=="string"&&t.length>0&&(t.charAt(t.length-1)!="/"&&(t+="/"),this.themeHost=t)},boot:function(){var e=document.getElementsByTagName("body")[0]||document.documentElement;this.div=document.createElement("div"),this.div.className="txOS",e.insertBefore(this.div,e.firstChild),this.themeHost&&(Tian.requireCSS(this.themeHost+this.theme+"/style.css"),this.setImagePath()),this.events=new Tian.Events(this,null,!0),this.createMainPanel(),this.createTitleBar(),this.createTaskbar(),this.createWindowManager()},exit:function(){this.wm.destroy(),this.wm=null,this.titleBar.destroy(),this.titleBar=null,this.taskbar.destroy(),this.taskbar=null,this.mainPanel.destroy(),this.mainPanel=null,this.events.destroy(),this.events=null},createMainPanel:function(){this.mainPanel=new Tian.Widget.MainPanel,this.div.appendChild(this.mainPanel.draw()),this.mainPanel.setOS(this)},createTitleBar:function(){this.titleBar=new Tian.Widget.TitleBar,this.div.appendChild(this.titleBar.draw()),this.titleBar.setOS(this)},createTaskbar:function(){this.taskbar=new Tian.Widget.Taskbar,this.div.appendChild(this.taskbar.draw()),this.taskbar.setOS(this)},createWindowManager:function(){this.wm=new Tian.Winager({container:this.div,taskbar:this.taskbar!==null?this.taskbar.div:null,defaultX:50,defaultY:35,iconWidth:36,cacheXHR:!0})},notify:function(e){var t=new Date;this.events.emit("notify",{data:{timestamp:t.getTime(),notification:""+e}})},changeTheme:function(e){var t,n;e&&e!=this.theme&&(t=this.themeHost+e+"/style.css",n=this.themeHost+this.theme+"/style.css",Tian.replaceCSS(n,t),this.theme=e,this.setImagePath())},setImagePath:function(e){e?this.imagePath=e:this.imagePath=this.themeHost+this.theme+"/img/"},getImagePath:function(){return this.imagePath||this.setImagePath(),this.imagePath},getWindowManager:function(){return this.wm},getEvents:function(){return this.events},getMainPanel:function(){return this.mainPanel},getTitleBar:function(){return this.titleBar},getTheme:function(){return this.theme},CLASS_NAME:"Tian.OS"}),Tian.Embedded=Tian.Class({theWin:null,theApp:null,dictionaries:null,closeConfirm:"",initialize:function(e){this.theWin=e&&e.win?e.win:null,this.theApp=e&&e.app?e.app:null,this.theWin&&(this.theWin.setCloseConfirm(this.closeConfirm),this.theWin.onselect=top.Tian.Function.bind(this.onSelect,this),this.theWin.ondeselect=top.Tian.Function.bind(this.onDeselect,this),this.theWin.oniconize=top.Tian.Function.bind(this.onIconize,this),this.theWin.onhttperror=top.Tian.Function.bind(this.onHttpError,this),this.theWin.onunload=top.Tian.Function.bind(this.onUnload,this)),this.onRun()},destroy:function(){this.onDestroy(),this.theWin=null,this.theApp=null,this.dictionaries=null},onRun:function(){},onDestroy:function(){},i18n:function(e){var t=this.dictionaries&&this.dictionaries[top.Tian.Lang.getCode()],n=t&&t[e];return n||(n=e),n},setTitle:function(e){this.theApp&&this.theApp.setTitle(e)},setIcon:function(e){this.theApp&&this.theApp.setIcon(e)},getTitle:function(){return this.theApp?this.theApp.title:""},getOS:function(){return this.theApp?this.theApp.getOS():null},onSelect:function(){},onDeselect:function(){},onIconize:function(){},onHttpError:function(e,t){},onUnload:function(){return this.destroy(),!0},CLASS_NAME:"Tian.Embedded"}),Tian.Number={dsep:".",tsep:",",limitSigDigs:function(e,t){var n=0;return t>0&&(n=parseFloat(e.toPrecision(t))),n},limitFixDigs:function(e,t){var n=0;return typeof t=="number"&&(n=parseFloat(e.toFixed(t))),n},format:function(e,t,n,r){t=typeof t!="undefined"?t:0,n=typeof n!="undefined"?n:Tian.Number.tsep,r=typeof r!="undefined"?r:Tian.Number.dsep,t!=null&&(e=parseFloat(e.toFixed(t)));var i=e.toString().split(".");i.length==1&&t==null&&(t=0);var s=i[0];if(n){var o=/(-?[0-9]+)([0-9]{3})/;while(o.test(s))s=s.replace(o,"$1"+n+"$2")}var u;if(t==0)u=s;else{var a=i.length>1?i[1]:"0";t!=null&&(a+=(new Array(t-a.length+1)).join("0")),u=s+r+a}return u},zeroize:function(e,t){t||(t=2),e+="";for(var n=0,r="";n<t-e.length;n++)r+="0";return r+e}},Tian.Date={format:function(e,t){if(!t)return e.toString();var n=/"[^"]*"|'[^']*'|\b(?:d{1,4}|m{1,4}|yy(?:yy)?|([hHMSlLtT])\1?|[lLZ])\b/g;return t.replace(n,function(t){switch(t){case"d":return e.getDate();case"dd":return Tian.Number.zeroize(e.getDate());case"m":return e.getMonth()+1;case"mm":return Tian.Number.zeroize(e.getMonth()+1);case"yy":return String(e.getFullYear()).substr(2);case"yyyy":return e.getFullYear();case"h":return e.getHours()%12||12;case"hh":return Tian.Number.zeroize(e.getHours()%12||12);case"H":return e.getHours();case"HH":return Tian.Number.zeroize(e.getHours());case"M":return e.getMinutes();case"MM":return Tian.Number.zeroize(e.getMinutes());case"S":return e.getSeconds();case"SS":return Tian.Number.zeroize(e.getSeconds());case"l":var n=e.getMilliseconds();return n>99&&(n=Math.round(n/10)),Tian.Number.zeroize(n);case"L":return Tian.Number.zeroize(e.getMilliseconds(),3);default:return t.substr(1,t.length-2)}})},doy:function(e){e||(e=new Date);var t=new Date(e.getFullYear(),0,1);return Math.ceil((e-t)/864e5)}},Tian.require=function(e,t,n){n=n||document;var r=n.getElementsByTagName("head")[0]||n.documentElement;if(!r){t&&t.call(null,"error");return}typeof e=="string"&&(e=[e]);var i=0,s=[],o=[];for(var u=0,a=e.length;u<a;u++)typeof e[u]=="string"&&(s[u]=!1,o[u]=n.createElement("script"),o[u].charset="utf-8",o[u].src=e[u],o[u].onload=o[u].onreadystatechange=function(n){return function(){!s[n]&&(!o[n].readyState||/loaded|complete/.test(o[n].readyState))&&(s[n]=!0,i+=1,o[n].onload=o[n].onreadystatechange=null,r&&o[n].parentNode&&r.removeChild(o[n]),o[n]=undefined,i===e.length&&t&&t.call(null))}}(u),r.insertBefore(o[u],r.firstChild))},Tian.requireCSS=function(e,t,n){n=n||document;var r=!1,i=n.getElementsByTagName("link");for(var s=0;s<i.length;s++)if(i[s]&&i[s].href==e){r=!0;break}if(!r){var o=n.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=e;var u=n.getElementsByTagName("head")[0]||n.documentElement;u.insertBefore(o,u.firstChild)}t&&t.call(null)},Tian.removeCSS=function(e,t,n){n=n||document;var r=n.getElementsByTagName("link");for(var i=r.length;i>=0;i--)r[i]&&r[i].href!=null&&r[i].href.indexOf(e)!=-1&&r[i].parentNode&&r[i].parentNode.removeChild(r[i]);t&&t.call(null)},Tian.replaceCSS=function(e,t,n,r){r=r||document,Tian.requireCSS(t,r),Tian.removeCSS(e,r),n&&n.call(null)},function(){var e=document.getElementsByTagName("script"),t=!1;for(var n=0;n<e.length;n++){t=e[n].getAttribute("data-boot");if(t){Tian.require(t);return}}}(),function(e){var t=function(e){return typeof e=="number"&&Math.floor(e)===e&&e>=0&&e<=255?e<16?"0"+e.toString(16):e.toString(16):""},n=function(e){var n="",r,i=e.length;for(r=0;r<i;r+=1)n+=t(e[r]);return n},r=function(e){e=e.replace(/[^A-Fa-f0-9]/g,"");var t=[];for(var n=0,r=e.length;n<r;n+=2)t.push(parseInt(e.slice(n,n+2),16));return t},i=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],s=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],o=function(e){return 0<=e&&e<s.length?s[e]:-1},u=function(e){var t=e&&e.length?e.length:0,n=Math.floor(t/3),r=t-3*n,s="",o=0;for(var u=0;u<n;u++){var a=e[o++]&255,f=e[o++]&255,l=e[o++]&255;s+=i[a>>2],s+=i[a<<4&63|f>>4
],s+=i[f<<2&63|l>>6],s+=i[l&63]}if(r==1){var a=e[o++]&255;s+=i[a>>2],s+=i[a<<4&63],s+="=="}else if(r==2){var a=e[o++]&255,f=e[o++]&255;s+=i[a>>2],s+=i[a<<4&63|f>>4],s+=i[f<<2&63],s+="="}return s},a=function(e){var t=e&&e.length?e.length:0,n=[],r=Math.floor(t/4);if(4*r!==t)return n;var i=0;t>0&&(e.charAt(t-1)==="="&&(i+=1,r-=1),e.charAt(t-2)==="="&&(i+=1));var s=0;for(var u=0;u<r;u++){var a=o(e.charCodeAt(s++)),f=o(e.charCodeAt(s++)),l=o(e.charCodeAt(s++)),c=o(e.charCodeAt(s++));n.push(255&(a<<2|f>>4)),n.push(255&(f<<4|l>>2)),n.push(255&(l<<6|c))}if(i==1){var a=o(e.charCodeAt(s++)),f=o(e.charCodeAt(s++)),l=o(e.charCodeAt(s++));n.push(255&(a<<2|f>>4)),n.push(255&(f<<4|l>>2))}else if(i==2){var a=o(e.charCodeAt(s++)),f=o(e.charCodeAt(s++));n.push(255&(a<<2|f>>4))}return n},f=function(e,t,n,r,i){var s,o,u=i*8-r-1,a=(1<<u)-1,f=a>>1,l=-7,c=n?0:i-1,h=n?1:-1,p=e[t+c];c+=h,s=p&(1<<-l)-1,p>>=-l,l+=u;for(;l>0;s=s*256+e[t+c],c+=h,l-=8);o=s&(1<<-l)-1,s>>=-l,l+=r;for(;l>0;o=o*256+e[t+c],c+=h,l-=8);if(s===0)s=1-f;else{if(s===a)return o?NaN:(p?-1:1)*Infinity;o+=Math.pow(2,r),s-=f}return(p?-1:1)*o*Math.pow(2,s-r)},l=function(e,t,n,r,i,s){var o,u,a,f=s*8-i-1,l=(1<<f)-1,c=l>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?s-1:0,d=r?-1:1,v=t<0||t===0&&1/t<0?1:0;t=Math.abs(t),isNaN(t)||t===Infinity?(u=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-o))<1&&(o--,a*=2),o+c>=1?t+=h/a:t+=h*Math.pow(2,1-c),t*a>=2&&(o++,a/=2),o+c>=l?(u=0,o=l):o+c>=1?(u=(t*a-1)*Math.pow(2,i),o+=c):(u=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));for(;i>=8;e[n+p]=u&255,p+=d,u/=256,i-=8);o=o<<i|u,f+=i;for(;f>0;e[n+p]=o&255,p+=d,o/=256,f-=8);e[n+p-d]|=v*128};e.Buffer=e.Class({buffer:null,initialize:function(t,n){var i,s;if(typeof t=="number"){this.buffer=[],s=parseInt(t,10);for(i=0;i<s;i+=1)this.buffer.push(0)}else if(e.Array.isArray(t))this.buffer=t;else if(typeof t=="string")switch(n){case"hex":this.buffer=r(t);break;case"base64":this.buffer=a(t);break;default:this.buffer=r(t)}else this.buffer=[]},getLength:function(){return this.buffer.length},toString:function(e){switch(e){case"hex":return n(this.buffer);case"base64":return u(this.buffer);default:return n(this.buffer)}return""},verify:function(e,t){switch(t){case"offset":return typeof e=="number"&&e>=0&&e<this.buffer.length&&Math.floor(e)===e;case"char":return typeof e=="string"&&e.length===1&&e.charCodeAt(0)<128;case"string":return typeof e=="string"&&e.length>0;case"uint8":return typeof e=="number"&&e>=0&&e<=255&&Math.floor(e)===e;case"uint16":return typeof e=="number"&&e>=0&&e<=65535&&Math.floor(e)===e;case"uint32":return typeof e=="number"&&e>=0&&e<=4294967295&&Math.floor(e)===e;case"int8":return typeof e=="number"&&e>=-128&&e<=127&&Math.floor(e)===e;case"int16":return typeof e=="number"&&e>=-32768&&e<=32767&&Math.floor(e)===e;case"int32":return typeof e=="number"&&e>=-2147483648&&e<=2147483647&&Math.floor(e)===e;case"float":return typeof e=="number"&&e>=-3.4028234663852886e38&&e<=3.4028234663852886e38;case"double":return typeof e=="number"&&e>=-1.7976931348623157e308&&e<=1.7976931348623157e308;default:return!1}},getChar:function(e){return this.verify(e,"offset")?String.fromCharCode(this.buffer[e]):undefined},setChar:function(e,t){return this.verify(e,"char")&&this.verify(t,"offset")?(this.buffer[t]=e.charCodeAt(0),!0):!1},getString:function(e,t){var n="",r,i;if(this.verify(e,"offset")&&this.verify(e+t-1,"offset")){t=e+t;for(r=e;r<t;)i=this.buffer[r++],i<128?n+=String.fromCharCode(i):i<224?n+=String.fromCharCode((31&i)<<6|(63&this.buffer[r++])<<0):i<240?n+=String.fromCharCode((15&i)<<12|(63&this.buffer[r++])<<6|(63&this.buffer[r++])<<0):i<248?n+=String.fromCharCode((7&i)<<18|(63&this.buffer[r++])<<12|(63&this.buffer[r++])<<6|(63&this.buffer[r++])<<0):i<252?n+=String.fromCharCode((3&i)<<24|(63&this.buffer[r++])<<18|(63&this.buffer[r++])<<12|(63&this.buffer[r++])<<6|(63&this.buffer[r++])<<0):i<254&&(n+=String.fromCharCode((1&i)<<30|(63&this.buffer[r++])<<24|(63&this.buffer[r++])<<18|(63&this.buffer[r++])<<12|(63&this.buffer[r++])<<6|(63&this.buffer[r++])<<0));return n}return undefined},setString:function(e,t){var n,r,i,s=[];if(!this.verify(e,"string")||!this.verify(t,"offset"))return!1;for(n=0,r=e.length;n<r;n++)i=e.charCodeAt(n),i<128?s.push(i):i<2048?(s.push(192|(i&1984)>>>6),s.push(128|i&63)):i<65536?(s.push(224|(i&61440)>>>12),s.push(128|(i&4032)>>>6),s.push(128|i&63)):(s.push(240|(i&1835008)>>>18),s.push(128|(i&258048)>>>12),s.push(128|(i&4032)>>>6),s.push(128|i&63));if(this.verify(t+s.length-1,"offset")){for(n=0,r=s.length;n<r;n++)this.buffer[t+n]=s[n];return!0}return!1},getUInt8:function(e){return this.verify(e,"offset")?this.buffer[e]:undefined},setUInt8:function(e,t){return this.verify(e,"uint8")&&this.verify(t,"offset")?(this.buffer[t]=e,!0):!1},getUInt16:function(e,t){var n=0;return this.verify(e,"offset")&&this.verify(e+1,"offset")?(t?(n=this.buffer[e]<<8,n|=this.buffer[e+1]):(n=this.buffer[e],n|=this.buffer[e+1]<<8),n):undefined},setUInt16:function(e,t,n){return this.verify(e,"uint16")&&this.verify(t,"offset")&&this.verify(t+1,"offset")?(n?(this.buffer[t]=(e&65280)>>>8,this.buffer[t+1]=e&255):(this.buffer[t+1]=(e&65280)>>>8,this.buffer[t]=e&255),!0):!1},getUInt32:function(e,t){var n=0;return this.verify(e,"offset")&&this.verify(e+3,"offset")?(t?(n=this.buffer[e+1]<<16,n|=this.buffer[e+2]<<8,n|=this.buffer[e+3],n+=this.buffer[e]<<24>>>0):(n=this.buffer[e+2]<<16,n|=this.buffer[e+1]<<8,n|=this.buffer[e],n+=this.buffer[e+3]<<24>>>0),n):undefined},setUInt32:function(e,t,n){return this.verify(e,"uint32")&&this.verify(t,"offset")&&this.verify(t+3,"offset")?(n?(this.buffer[t]=e>>>24&255,this.buffer[t+1]=e>>>16&255,this.buffer[t+2]=e>>>8&255,this.buffer[t+3]=e&255):(this.buffer[t+3]=e>>>24&255,this.buffer[t+2]=e>>>16&255,this.buffer[t+1]=e>>>8&255,this.buffer[t]=e&255),!0):!1},getInt8:function(e){return this.verify(e,"offset")?this.buffer[e]&128?(255-this.buffer[e]+1)*-1:this.buffer[e]:undefined},setInt8:function(e,t){return this.verify(e,"int8")&&this.verify(t,"offset")?e>=0?this.setUInt8(e,t):this.setUInt8(255+e+1,t):!1},getInt16:function(e,t){var n=0;return this.verify(e,"offset")&&this.verify(e+1,"offset")?(n=this.getUInt16(e,t),n&32768&&(n=(65535-n+1)*-1),n):undefined},setInt16:function(e,t,n){return this.verify(e,"int16")&&this.verify(t,"offset")&&this.verify(t+1,"offset")?e>=0?this.setUInt16(e,t,n):this.setUInt16(65535+e+1,t,n):!1},getInt32:function(e,t){var n=0;return this.verify(e,"offset")&&this.verify(e+3,"offset")?(n=this.getUInt32(e,t),n&2147483648&&(n=(4294967295-n+1)*-1),n):undefined},setInt32:function(e,t,n){return this.verify(e,"int32")&&this.verify(t,"offset")&&this.verify(t+3,"offset")?e>=0?this.setUInt32(e,t,n):this.setUInt32(4294967295+e+1,t,n):!1},getFloat:function(e,t){return this.verify(e,"offset")&&this.verify(e+3,"offset")?f(this.buffer,e,t,23,4):undefined},setFloat:function(e,t,n){return this.verify(e,"float")&&this.verify(t,"offset")&&this.verify(t+3,"offset")?(l(this.buffer,e,t,n,23,4),!0):!1},getDouble:function(e,t){return this.verify(e,"offset")&&this.verify(e+7,"offset")?f(this.buffer,e,t,52,8):undefined},setDouble:function(e,t,n){return this.verify(e,"double")&&this.verify(t,"offset")&&this.verify(t+7,"offset")?(l(this.buffer,e,t,n,52,8),!0):!1}})}(Tian);